------------------------------------------------------------------------------------------
------------------------------------------------------------------------------------------
--                             按月建分区 测试
------------------------------------------------------------------------------------------
------------------------------------------------------------------------------------------
set citus.shard_replication_factor=1;
set citus.next_shard_id to 990000;
set citus.shard_count=2;

-- 创建分区表
drop table if exists tb1 cascade;
NOTICE:  table "tb1" does not exist, skipping
create table tb1(c1 int, c2 date, c3 int) partition by range (c2);
select create_distributed_table('tb1', 'c1');
 create_distributed_table 
--------------------------
 
(1 row)


-- 批量增加分区
select rds.add_range_partitions('public.tb1', '2019-03-01'::date, '1 month', 10);
 add_range_partitions 
----------------------
 
(1 row)


-- 验证分区
select relname, relnamespace::regnamespace::text, pg_get_expr(relpartbound, oid, true) vals
  from pg_class
 where relnamespace::regnamespace::text='public' and relname like 'tb1%' and relispartition=true
 order by relname;
   relname    | relnamespace |                       vals                       
--------------+--------------+--------------------------------------------------
 tb1_20190301 | public       | FOR VALUES FROM ('03-01-2019') TO ('04-01-2019')
 tb1_20190401 | public       | FOR VALUES FROM ('04-01-2019') TO ('05-01-2019')
 tb1_20190501 | public       | FOR VALUES FROM ('05-01-2019') TO ('06-01-2019')
 tb1_20190601 | public       | FOR VALUES FROM ('06-01-2019') TO ('07-01-2019')
 tb1_20190701 | public       | FOR VALUES FROM ('07-01-2019') TO ('08-01-2019')
 tb1_20190801 | public       | FOR VALUES FROM ('08-01-2019') TO ('09-01-2019')
 tb1_20190901 | public       | FOR VALUES FROM ('09-01-2019') TO ('10-01-2019')
 tb1_20191001 | public       | FOR VALUES FROM ('10-01-2019') TO ('11-01-2019')
 tb1_20191101 | public       | FOR VALUES FROM ('11-01-2019') TO ('12-01-2019')
 tb1_20191201 | public       | FOR VALUES FROM ('12-01-2019') TO ('01-01-2020')
(10 rows)


\c - - - :worker_1_port
select relname, relnamespace::regnamespace::text, pg_get_expr(relpartbound, oid, true) vals
  from pg_class
 where relnamespace::regnamespace::text='public' and relname like 'tb1%' and relispartition=true
 order by relname;
       relname       | relnamespace |                       vals                       
---------------------+--------------+--------------------------------------------------
 tb1_20190301_990002 | public       | FOR VALUES FROM ('03-01-2019') TO ('04-01-2019')
 tb1_20190401_990004 | public       | FOR VALUES FROM ('04-01-2019') TO ('05-01-2019')
 tb1_20190501_990006 | public       | FOR VALUES FROM ('05-01-2019') TO ('06-01-2019')
 tb1_20190601_990008 | public       | FOR VALUES FROM ('06-01-2019') TO ('07-01-2019')
 tb1_20190701_990010 | public       | FOR VALUES FROM ('07-01-2019') TO ('08-01-2019')
 tb1_20190801_990012 | public       | FOR VALUES FROM ('08-01-2019') TO ('09-01-2019')
 tb1_20190901_990014 | public       | FOR VALUES FROM ('09-01-2019') TO ('10-01-2019')
 tb1_20191001_990016 | public       | FOR VALUES FROM ('10-01-2019') TO ('11-01-2019')
 tb1_20191101_990018 | public       | FOR VALUES FROM ('11-01-2019') TO ('12-01-2019')
 tb1_20191201_990020 | public       | FOR VALUES FROM ('12-01-2019') TO ('01-01-2020')
(10 rows)


\c - - - :worker_2_port
select relname, relnamespace::regnamespace::text, pg_get_expr(relpartbound, oid, true) vals
  from pg_class
 where relnamespace::regnamespace::text='public' and relname like 'tb1%' and relispartition=true
 order by relname;
       relname       | relnamespace |                       vals                       
---------------------+--------------+--------------------------------------------------
 tb1_20190301_990003 | public       | FOR VALUES FROM ('03-01-2019') TO ('04-01-2019')
 tb1_20190401_990005 | public       | FOR VALUES FROM ('04-01-2019') TO ('05-01-2019')
 tb1_20190501_990007 | public       | FOR VALUES FROM ('05-01-2019') TO ('06-01-2019')
 tb1_20190601_990009 | public       | FOR VALUES FROM ('06-01-2019') TO ('07-01-2019')
 tb1_20190701_990011 | public       | FOR VALUES FROM ('07-01-2019') TO ('08-01-2019')
 tb1_20190801_990013 | public       | FOR VALUES FROM ('08-01-2019') TO ('09-01-2019')
 tb1_20190901_990015 | public       | FOR VALUES FROM ('09-01-2019') TO ('10-01-2019')
 tb1_20191001_990017 | public       | FOR VALUES FROM ('10-01-2019') TO ('11-01-2019')
 tb1_20191101_990019 | public       | FOR VALUES FROM ('11-01-2019') TO ('12-01-2019')
 tb1_20191201_990021 | public       | FOR VALUES FROM ('12-01-2019') TO ('01-01-2020')
(10 rows)


\c - - - :master_port

-- 插入数据
insert into public.tb1 values(1, '20190301'::date, 1);
insert into public.tb1 values(2, '20190402'::date, 2);
insert into public.tb1 values(3, '20190503'::date, 3);
insert into public.tb1 values(4, '20190604'::date, 4);
insert into public.tb1 values(5, '20190705'::date, 5);
insert into public.tb1 values(6, '20190806'::date, 6);
insert into public.tb1 values(7, '20190907'::date, 7);
insert into public.tb1 values(8, '20191008'::date, 8);
insert into public.tb1 values(9, '20191109'::date, 9);
insert into public.tb1 values(10, '20191210'::date, 10);

-- 验证数据
select * from public.tb1 order by c1;
 c1 |     c2     | c3 
----+------------+----
  1 | 03-01-2019 |  1
  2 | 04-02-2019 |  2
  3 | 05-03-2019 |  3
  4 | 06-04-2019 |  4
  5 | 07-05-2019 |  5
  6 | 08-06-2019 |  6
  7 | 09-07-2019 |  7
  8 | 10-08-2019 |  8
  9 | 11-09-2019 |  9
 10 | 12-10-2019 | 10
(10 rows)

select * from public.tb1_20190301 order by c1;
 c1 |     c2     | c3 
----+------------+----
  1 | 03-01-2019 |  1
(1 row)

select * from public.tb1_20190401 order by c1;
 c1 |     c2     | c3 
----+------------+----
  2 | 04-02-2019 |  2
(1 row)

select * from public.tb1_20190501 order by c1;
 c1 |     c2     | c3 
----+------------+----
  3 | 05-03-2019 |  3
(1 row)

select * from public.tb1_20190601 order by c1;
 c1 |     c2     | c3 
----+------------+----
  4 | 06-04-2019 |  4
(1 row)

select * from public.tb1_20190701 order by c1;
 c1 |     c2     | c3 
----+------------+----
  5 | 07-05-2019 |  5
(1 row)

select * from public.tb1_20190801 order by c1;
 c1 |     c2     | c3 
----+------------+----
  6 | 08-06-2019 |  6
(1 row)

select * from public.tb1_20190901 order by c1;
 c1 |     c2     | c3 
----+------------+----
  7 | 09-07-2019 |  7
(1 row)

select * from public.tb1_20191001 order by c1;
 c1 |     c2     | c3 
----+------------+----
  8 | 10-08-2019 |  8
(1 row)

select * from public.tb1_20191101 order by c1;
 c1 |     c2     | c3 
----+------------+----
  9 | 11-09-2019 |  9
(1 row)

select * from public.tb1_20191201 order by c1;
 c1 |     c2     | c3 
----+------------+----
 10 | 12-10-2019 | 10
(1 row)


-- 分区表添加索引（包含大小写、空格制表符）
select rds.create_idx_on_parted_table('public.TB1', 'idx_tb1', 'create INDEX 	%i on 	%t(c1)');
                                                    create_idx_on_parted_table                                                     
-----------------------------------------------------------------------------------------------------------------------------------
 ("select rds.func_create_idx_on_paritition('create INDEX        idx_tb1_16916 on        public.tb1_20190301(c1)','')",success,"")
 ("select rds.func_create_idx_on_paritition('create INDEX        idx_tb1_16920 on        public.tb1_20190401(c1)','')",success,"")
 ("select rds.func_create_idx_on_paritition('create INDEX        idx_tb1_16924 on        public.tb1_20190501(c1)','')",success,"")
 ("select rds.func_create_idx_on_paritition('create INDEX        idx_tb1_16928 on        public.tb1_20190601(c1)','')",success,"")
 ("select rds.func_create_idx_on_paritition('create INDEX        idx_tb1_16932 on        public.tb1_20190701(c1)','')",success,"")
 ("select rds.func_create_idx_on_paritition('create INDEX        idx_tb1_16936 on        public.tb1_20190801(c1)','')",success,"")
 ("select rds.func_create_idx_on_paritition('create INDEX        idx_tb1_16940 on        public.tb1_20190901(c1)','')",success,"")
 ("select rds.func_create_idx_on_paritition('create INDEX        idx_tb1_16944 on        public.tb1_20191001(c1)','')",success,"")
 ("select rds.func_create_idx_on_paritition('create INDEX        idx_tb1_16948 on        public.tb1_20191101(c1)','')",success,"")
 ("select rds.func_create_idx_on_paritition('create INDEX        idx_tb1_16952 on        public.tb1_20191201(c1)','')",success,"")
(10 rows)


-- 验证索引
select * from pg_indexes where schemaname='public' and tablename like 'tb1%' order by tablename, indexname;
 schemaname |  tablename   |   indexname   | tablespace |                          indexdef                           
------------+--------------+---------------+------------+-------------------------------------------------------------
 public     | tb1_20190301 | idx_tb1_16916 |            | CREATE INDEX idx_tb1_16916 ON tb1_20190301 USING btree (c1)
 public     | tb1_20190401 | idx_tb1_16920 |            | CREATE INDEX idx_tb1_16920 ON tb1_20190401 USING btree (c1)
 public     | tb1_20190501 | idx_tb1_16924 |            | CREATE INDEX idx_tb1_16924 ON tb1_20190501 USING btree (c1)
 public     | tb1_20190601 | idx_tb1_16928 |            | CREATE INDEX idx_tb1_16928 ON tb1_20190601 USING btree (c1)
 public     | tb1_20190701 | idx_tb1_16932 |            | CREATE INDEX idx_tb1_16932 ON tb1_20190701 USING btree (c1)
 public     | tb1_20190801 | idx_tb1_16936 |            | CREATE INDEX idx_tb1_16936 ON tb1_20190801 USING btree (c1)
 public     | tb1_20190901 | idx_tb1_16940 |            | CREATE INDEX idx_tb1_16940 ON tb1_20190901 USING btree (c1)
 public     | tb1_20191001 | idx_tb1_16944 |            | CREATE INDEX idx_tb1_16944 ON tb1_20191001 USING btree (c1)
 public     | tb1_20191101 | idx_tb1_16948 |            | CREATE INDEX idx_tb1_16948 ON tb1_20191101 USING btree (c1)
 public     | tb1_20191201 | idx_tb1_16952 |            | CREATE INDEX idx_tb1_16952 ON tb1_20191201 USING btree (c1)
(10 rows)

select * from rds.user_tab_part_indexes_def;
 tab_name | idx_name |            idx_sql             | is_pkey 
----------+----------+--------------------------------+---------
 tb1      | idx_tb1  | create index    %i on   %t(c1) | f
(1 row)


\c - - - :worker_1_port
select * from pg_indexes where schemaname='public' and tablename like 'tb1%' order by tablename, indexname;
 schemaname |      tablename      |      indexname       | tablespace |                                 indexdef                                  
------------+---------------------+----------------------+------------+---------------------------------------------------------------------------
 public     | tb1_20190301_990002 | idx_tb1_16916_990002 |            | CREATE INDEX idx_tb1_16916_990002 ON tb1_20190301_990002 USING btree (c1)
 public     | tb1_20190401_990004 | idx_tb1_16920_990004 |            | CREATE INDEX idx_tb1_16920_990004 ON tb1_20190401_990004 USING btree (c1)
 public     | tb1_20190501_990006 | idx_tb1_16924_990006 |            | CREATE INDEX idx_tb1_16924_990006 ON tb1_20190501_990006 USING btree (c1)
 public     | tb1_20190601_990008 | idx_tb1_16928_990008 |            | CREATE INDEX idx_tb1_16928_990008 ON tb1_20190601_990008 USING btree (c1)
 public     | tb1_20190701_990010 | idx_tb1_16932_990010 |            | CREATE INDEX idx_tb1_16932_990010 ON tb1_20190701_990010 USING btree (c1)
 public     | tb1_20190801_990012 | idx_tb1_16936_990012 |            | CREATE INDEX idx_tb1_16936_990012 ON tb1_20190801_990012 USING btree (c1)
 public     | tb1_20190901_990014 | idx_tb1_16940_990014 |            | CREATE INDEX idx_tb1_16940_990014 ON tb1_20190901_990014 USING btree (c1)
 public     | tb1_20191001_990016 | idx_tb1_16944_990016 |            | CREATE INDEX idx_tb1_16944_990016 ON tb1_20191001_990016 USING btree (c1)
 public     | tb1_20191101_990018 | idx_tb1_16948_990018 |            | CREATE INDEX idx_tb1_16948_990018 ON tb1_20191101_990018 USING btree (c1)
 public     | tb1_20191201_990020 | idx_tb1_16952_990020 |            | CREATE INDEX idx_tb1_16952_990020 ON tb1_20191201_990020 USING btree (c1)
(10 rows)


\c - - - :worker_2_port
select * from pg_indexes where schemaname='public' and tablename like 'tb1%' order by tablename, indexname;
 schemaname |      tablename      |      indexname       | tablespace |                                 indexdef                                  
------------+---------------------+----------------------+------------+---------------------------------------------------------------------------
 public     | tb1_20190301_990003 | idx_tb1_16916_990003 |            | CREATE INDEX idx_tb1_16916_990003 ON tb1_20190301_990003 USING btree (c1)
 public     | tb1_20190401_990005 | idx_tb1_16920_990005 |            | CREATE INDEX idx_tb1_16920_990005 ON tb1_20190401_990005 USING btree (c1)
 public     | tb1_20190501_990007 | idx_tb1_16924_990007 |            | CREATE INDEX idx_tb1_16924_990007 ON tb1_20190501_990007 USING btree (c1)
 public     | tb1_20190601_990009 | idx_tb1_16928_990009 |            | CREATE INDEX idx_tb1_16928_990009 ON tb1_20190601_990009 USING btree (c1)
 public     | tb1_20190701_990011 | idx_tb1_16932_990011 |            | CREATE INDEX idx_tb1_16932_990011 ON tb1_20190701_990011 USING btree (c1)
 public     | tb1_20190801_990013 | idx_tb1_16936_990013 |            | CREATE INDEX idx_tb1_16936_990013 ON tb1_20190801_990013 USING btree (c1)
 public     | tb1_20190901_990015 | idx_tb1_16940_990015 |            | CREATE INDEX idx_tb1_16940_990015 ON tb1_20190901_990015 USING btree (c1)
 public     | tb1_20191001_990017 | idx_tb1_16944_990017 |            | CREATE INDEX idx_tb1_16944_990017 ON tb1_20191001_990017 USING btree (c1)
 public     | tb1_20191101_990019 | idx_tb1_16948_990019 |            | CREATE INDEX idx_tb1_16948_990019 ON tb1_20191101_990019 USING btree (c1)
 public     | tb1_20191201_990021 | idx_tb1_16952_990021 |            | CREATE INDEX idx_tb1_16952_990021 ON tb1_20191201_990021 USING btree (c1)
(10 rows)


\c - - - :master_port

-- 分区表添加索引（语法错误）
select rds.create_idx_on_parted_table('public.tb1', 'idx_tb1_e', 'create1 index %i on %t(c1)');
                                                               create_idx_on_parted_table                                                                
---------------------------------------------------------------------------------------------------------------------------------------------------------
 ("select rds.func_create_idx_on_paritition('create1 index idx_tb1_e_16916 on public.tb1_20190301(c1)','')",error,"syntax error at or near ""create1""")
 ("select rds.func_create_idx_on_paritition('create1 index idx_tb1_e_16920 on public.tb1_20190401(c1)','')",error,"syntax error at or near ""create1""")
 ("select rds.func_create_idx_on_paritition('create1 index idx_tb1_e_16924 on public.tb1_20190501(c1)','')",error,"syntax error at or near ""create1""")
 ("select rds.func_create_idx_on_paritition('create1 index idx_tb1_e_16928 on public.tb1_20190601(c1)','')",error,"syntax error at or near ""create1""")
 ("select rds.func_create_idx_on_paritition('create1 index idx_tb1_e_16932 on public.tb1_20190701(c1)','')",error,"syntax error at or near ""create1""")
 ("select rds.func_create_idx_on_paritition('create1 index idx_tb1_e_16936 on public.tb1_20190801(c1)','')",error,"syntax error at or near ""create1""")
 ("select rds.func_create_idx_on_paritition('create1 index idx_tb1_e_16940 on public.tb1_20190901(c1)','')",error,"syntax error at or near ""create1""")
 ("select rds.func_create_idx_on_paritition('create1 index idx_tb1_e_16944 on public.tb1_20191001(c1)','')",error,"syntax error at or near ""create1""")
 ("select rds.func_create_idx_on_paritition('create1 index idx_tb1_e_16948 on public.tb1_20191101(c1)','')",error,"syntax error at or near ""create1""")
 ("select rds.func_create_idx_on_paritition('create1 index idx_tb1_e_16952 on public.tb1_20191201(c1)','')",error,"syntax error at or near ""create1""")
(10 rows)


-- 验证索引
select * from pg_indexes where schemaname='public' and tablename like 'tb1%' order by tablename, indexname;
 schemaname |  tablename   |   indexname   | tablespace |                          indexdef                           
------------+--------------+---------------+------------+-------------------------------------------------------------
 public     | tb1_20190301 | idx_tb1_16916 |            | CREATE INDEX idx_tb1_16916 ON tb1_20190301 USING btree (c1)
 public     | tb1_20190401 | idx_tb1_16920 |            | CREATE INDEX idx_tb1_16920 ON tb1_20190401 USING btree (c1)
 public     | tb1_20190501 | idx_tb1_16924 |            | CREATE INDEX idx_tb1_16924 ON tb1_20190501 USING btree (c1)
 public     | tb1_20190601 | idx_tb1_16928 |            | CREATE INDEX idx_tb1_16928 ON tb1_20190601 USING btree (c1)
 public     | tb1_20190701 | idx_tb1_16932 |            | CREATE INDEX idx_tb1_16932 ON tb1_20190701 USING btree (c1)
 public     | tb1_20190801 | idx_tb1_16936 |            | CREATE INDEX idx_tb1_16936 ON tb1_20190801 USING btree (c1)
 public     | tb1_20190901 | idx_tb1_16940 |            | CREATE INDEX idx_tb1_16940 ON tb1_20190901 USING btree (c1)
 public     | tb1_20191001 | idx_tb1_16944 |            | CREATE INDEX idx_tb1_16944 ON tb1_20191001 USING btree (c1)
 public     | tb1_20191101 | idx_tb1_16948 |            | CREATE INDEX idx_tb1_16948 ON tb1_20191101 USING btree (c1)
 public     | tb1_20191201 | idx_tb1_16952 |            | CREATE INDEX idx_tb1_16952 ON tb1_20191201 USING btree (c1)
(10 rows)

select * from rds.user_tab_part_indexes_def;
 tab_name | idx_name |            idx_sql             | is_pkey 
----------+----------+--------------------------------+---------
 tb1      | idx_tb1  | create index    %i on   %t(c1) | f
(1 row)


\c - - - :worker_1_port
select * from pg_indexes where schemaname='public' and tablename like 'tb1%' order by tablename, indexname;
 schemaname |      tablename      |      indexname       | tablespace |                                 indexdef                                  
------------+---------------------+----------------------+------------+---------------------------------------------------------------------------
 public     | tb1_20190301_990002 | idx_tb1_16916_990002 |            | CREATE INDEX idx_tb1_16916_990002 ON tb1_20190301_990002 USING btree (c1)
 public     | tb1_20190401_990004 | idx_tb1_16920_990004 |            | CREATE INDEX idx_tb1_16920_990004 ON tb1_20190401_990004 USING btree (c1)
 public     | tb1_20190501_990006 | idx_tb1_16924_990006 |            | CREATE INDEX idx_tb1_16924_990006 ON tb1_20190501_990006 USING btree (c1)
 public     | tb1_20190601_990008 | idx_tb1_16928_990008 |            | CREATE INDEX idx_tb1_16928_990008 ON tb1_20190601_990008 USING btree (c1)
 public     | tb1_20190701_990010 | idx_tb1_16932_990010 |            | CREATE INDEX idx_tb1_16932_990010 ON tb1_20190701_990010 USING btree (c1)
 public     | tb1_20190801_990012 | idx_tb1_16936_990012 |            | CREATE INDEX idx_tb1_16936_990012 ON tb1_20190801_990012 USING btree (c1)
 public     | tb1_20190901_990014 | idx_tb1_16940_990014 |            | CREATE INDEX idx_tb1_16940_990014 ON tb1_20190901_990014 USING btree (c1)
 public     | tb1_20191001_990016 | idx_tb1_16944_990016 |            | CREATE INDEX idx_tb1_16944_990016 ON tb1_20191001_990016 USING btree (c1)
 public     | tb1_20191101_990018 | idx_tb1_16948_990018 |            | CREATE INDEX idx_tb1_16948_990018 ON tb1_20191101_990018 USING btree (c1)
 public     | tb1_20191201_990020 | idx_tb1_16952_990020 |            | CREATE INDEX idx_tb1_16952_990020 ON tb1_20191201_990020 USING btree (c1)
(10 rows)


\c - - - :worker_2_port
select * from pg_indexes where schemaname='public' and tablename like 'tb1%' order by tablename, indexname;
 schemaname |      tablename      |      indexname       | tablespace |                                 indexdef                                  
------------+---------------------+----------------------+------------+---------------------------------------------------------------------------
 public     | tb1_20190301_990003 | idx_tb1_16916_990003 |            | CREATE INDEX idx_tb1_16916_990003 ON tb1_20190301_990003 USING btree (c1)
 public     | tb1_20190401_990005 | idx_tb1_16920_990005 |            | CREATE INDEX idx_tb1_16920_990005 ON tb1_20190401_990005 USING btree (c1)
 public     | tb1_20190501_990007 | idx_tb1_16924_990007 |            | CREATE INDEX idx_tb1_16924_990007 ON tb1_20190501_990007 USING btree (c1)
 public     | tb1_20190601_990009 | idx_tb1_16928_990009 |            | CREATE INDEX idx_tb1_16928_990009 ON tb1_20190601_990009 USING btree (c1)
 public     | tb1_20190701_990011 | idx_tb1_16932_990011 |            | CREATE INDEX idx_tb1_16932_990011 ON tb1_20190701_990011 USING btree (c1)
 public     | tb1_20190801_990013 | idx_tb1_16936_990013 |            | CREATE INDEX idx_tb1_16936_990013 ON tb1_20190801_990013 USING btree (c1)
 public     | tb1_20190901_990015 | idx_tb1_16940_990015 |            | CREATE INDEX idx_tb1_16940_990015 ON tb1_20190901_990015 USING btree (c1)
 public     | tb1_20191001_990017 | idx_tb1_16944_990017 |            | CREATE INDEX idx_tb1_16944_990017 ON tb1_20191001_990017 USING btree (c1)
 public     | tb1_20191101_990019 | idx_tb1_16948_990019 |            | CREATE INDEX idx_tb1_16948_990019 ON tb1_20191101_990019 USING btree (c1)
 public     | tb1_20191201_990021 | idx_tb1_16952_990021 |            | CREATE INDEX idx_tb1_16952_990021 ON tb1_20191201_990021 USING btree (c1)
(10 rows)


\c - - - :master_port

-- 分区表添加索引（索引名长度超34bytes）
select rds.create_idx_on_parted_table('public.tb1', 'idx_tb12345678901234567890123456789', 'create index %i on %t(c1)');
ERROR:  The length of index name could not be more than 34 bytes, table name: tb1 index name: idx_tb12345678901234567890123456789
CONTEXT:  PL/pgSQL function rds.create_idx_on_parted_table(regclass,character varying,text,boolean) line 34 at RAISE
select rds.create_idx_on_parted_table('public.tb1', 'idx_tb1234567890123456789012345678', 'create index %i on %t(c1)');
                                                           create_idx_on_parted_table                                                           
------------------------------------------------------------------------------------------------------------------------------------------------
 ("select rds.func_create_idx_on_paritition('create index idx_tb1234567890123456789012345678_16916 on public.tb1_20190301(c1)','')",success,"")
 ("select rds.func_create_idx_on_paritition('create index idx_tb1234567890123456789012345678_16920 on public.tb1_20190401(c1)','')",success,"")
 ("select rds.func_create_idx_on_paritition('create index idx_tb1234567890123456789012345678_16924 on public.tb1_20190501(c1)','')",success,"")
 ("select rds.func_create_idx_on_paritition('create index idx_tb1234567890123456789012345678_16928 on public.tb1_20190601(c1)','')",success,"")
 ("select rds.func_create_idx_on_paritition('create index idx_tb1234567890123456789012345678_16932 on public.tb1_20190701(c1)','')",success,"")
 ("select rds.func_create_idx_on_paritition('create index idx_tb1234567890123456789012345678_16936 on public.tb1_20190801(c1)','')",success,"")
 ("select rds.func_create_idx_on_paritition('create index idx_tb1234567890123456789012345678_16940 on public.tb1_20190901(c1)','')",success,"")
 ("select rds.func_create_idx_on_paritition('create index idx_tb1234567890123456789012345678_16944 on public.tb1_20191001(c1)','')",success,"")
 ("select rds.func_create_idx_on_paritition('create index idx_tb1234567890123456789012345678_16948 on public.tb1_20191101(c1)','')",success,"")
 ("select rds.func_create_idx_on_paritition('create index idx_tb1234567890123456789012345678_16952 on public.tb1_20191201(c1)','')",success,"")
(10 rows)


-- 验证索引
select * from pg_indexes where schemaname='public' and tablename like 'tb1%' order by tablename, indexname;
 schemaname |  tablename   |                indexname                 | tablespace |                                        indexdef                                        
------------+--------------+------------------------------------------+------------+----------------------------------------------------------------------------------------
 public     | tb1_20190301 | idx_tb1234567890123456789012345678_16916 |            | CREATE INDEX idx_tb1234567890123456789012345678_16916 ON tb1_20190301 USING btree (c1)
 public     | tb1_20190301 | idx_tb1_16916                            |            | CREATE INDEX idx_tb1_16916 ON tb1_20190301 USING btree (c1)
 public     | tb1_20190401 | idx_tb1234567890123456789012345678_16920 |            | CREATE INDEX idx_tb1234567890123456789012345678_16920 ON tb1_20190401 USING btree (c1)
 public     | tb1_20190401 | idx_tb1_16920                            |            | CREATE INDEX idx_tb1_16920 ON tb1_20190401 USING btree (c1)
 public     | tb1_20190501 | idx_tb1234567890123456789012345678_16924 |            | CREATE INDEX idx_tb1234567890123456789012345678_16924 ON tb1_20190501 USING btree (c1)
 public     | tb1_20190501 | idx_tb1_16924                            |            | CREATE INDEX idx_tb1_16924 ON tb1_20190501 USING btree (c1)
 public     | tb1_20190601 | idx_tb1234567890123456789012345678_16928 |            | CREATE INDEX idx_tb1234567890123456789012345678_16928 ON tb1_20190601 USING btree (c1)
 public     | tb1_20190601 | idx_tb1_16928                            |            | CREATE INDEX idx_tb1_16928 ON tb1_20190601 USING btree (c1)
 public     | tb1_20190701 | idx_tb1234567890123456789012345678_16932 |            | CREATE INDEX idx_tb1234567890123456789012345678_16932 ON tb1_20190701 USING btree (c1)
 public     | tb1_20190701 | idx_tb1_16932                            |            | CREATE INDEX idx_tb1_16932 ON tb1_20190701 USING btree (c1)
 public     | tb1_20190801 | idx_tb1234567890123456789012345678_16936 |            | CREATE INDEX idx_tb1234567890123456789012345678_16936 ON tb1_20190801 USING btree (c1)
 public     | tb1_20190801 | idx_tb1_16936                            |            | CREATE INDEX idx_tb1_16936 ON tb1_20190801 USING btree (c1)
 public     | tb1_20190901 | idx_tb1234567890123456789012345678_16940 |            | CREATE INDEX idx_tb1234567890123456789012345678_16940 ON tb1_20190901 USING btree (c1)
 public     | tb1_20190901 | idx_tb1_16940                            |            | CREATE INDEX idx_tb1_16940 ON tb1_20190901 USING btree (c1)
 public     | tb1_20191001 | idx_tb1234567890123456789012345678_16944 |            | CREATE INDEX idx_tb1234567890123456789012345678_16944 ON tb1_20191001 USING btree (c1)
 public     | tb1_20191001 | idx_tb1_16944                            |            | CREATE INDEX idx_tb1_16944 ON tb1_20191001 USING btree (c1)
 public     | tb1_20191101 | idx_tb1234567890123456789012345678_16948 |            | CREATE INDEX idx_tb1234567890123456789012345678_16948 ON tb1_20191101 USING btree (c1)
 public     | tb1_20191101 | idx_tb1_16948                            |            | CREATE INDEX idx_tb1_16948 ON tb1_20191101 USING btree (c1)
 public     | tb1_20191201 | idx_tb1234567890123456789012345678_16952 |            | CREATE INDEX idx_tb1234567890123456789012345678_16952 ON tb1_20191201 USING btree (c1)
 public     | tb1_20191201 | idx_tb1_16952                            |            | CREATE INDEX idx_tb1_16952 ON tb1_20191201 USING btree (c1)
(20 rows)

select * from rds.user_tab_part_indexes_def;
 tab_name |              idx_name              |            idx_sql             | is_pkey 
----------+------------------------------------+--------------------------------+---------
 tb1      | idx_tb1                            | create index    %i on   %t(c1) | f
 tb1      | idx_tb1234567890123456789012345678 | create index %i on %t(c1)      | f
(2 rows)


\c - - - :worker_1_port
select * from pg_indexes where schemaname='public' and tablename like 'tb1%' order by tablename, indexname;
 schemaname |      tablename      |                    indexname                    | tablespace |                                               indexdef                                               
------------+---------------------+-------------------------------------------------+------------+------------------------------------------------------------------------------------------------------
 public     | tb1_20190301_990002 | idx_tb1234567890123456789012345678_16916_990002 |            | CREATE INDEX idx_tb1234567890123456789012345678_16916_990002 ON tb1_20190301_990002 USING btree (c1)
 public     | tb1_20190301_990002 | idx_tb1_16916_990002                            |            | CREATE INDEX idx_tb1_16916_990002 ON tb1_20190301_990002 USING btree (c1)
 public     | tb1_20190401_990004 | idx_tb1234567890123456789012345678_16920_990004 |            | CREATE INDEX idx_tb1234567890123456789012345678_16920_990004 ON tb1_20190401_990004 USING btree (c1)
 public     | tb1_20190401_990004 | idx_tb1_16920_990004                            |            | CREATE INDEX idx_tb1_16920_990004 ON tb1_20190401_990004 USING btree (c1)
 public     | tb1_20190501_990006 | idx_tb1234567890123456789012345678_16924_990006 |            | CREATE INDEX idx_tb1234567890123456789012345678_16924_990006 ON tb1_20190501_990006 USING btree (c1)
 public     | tb1_20190501_990006 | idx_tb1_16924_990006                            |            | CREATE INDEX idx_tb1_16924_990006 ON tb1_20190501_990006 USING btree (c1)
 public     | tb1_20190601_990008 | idx_tb1234567890123456789012345678_16928_990008 |            | CREATE INDEX idx_tb1234567890123456789012345678_16928_990008 ON tb1_20190601_990008 USING btree (c1)
 public     | tb1_20190601_990008 | idx_tb1_16928_990008                            |            | CREATE INDEX idx_tb1_16928_990008 ON tb1_20190601_990008 USING btree (c1)
 public     | tb1_20190701_990010 | idx_tb1234567890123456789012345678_16932_990010 |            | CREATE INDEX idx_tb1234567890123456789012345678_16932_990010 ON tb1_20190701_990010 USING btree (c1)
 public     | tb1_20190701_990010 | idx_tb1_16932_990010                            |            | CREATE INDEX idx_tb1_16932_990010 ON tb1_20190701_990010 USING btree (c1)
 public     | tb1_20190801_990012 | idx_tb1234567890123456789012345678_16936_990012 |            | CREATE INDEX idx_tb1234567890123456789012345678_16936_990012 ON tb1_20190801_990012 USING btree (c1)
 public     | tb1_20190801_990012 | idx_tb1_16936_990012                            |            | CREATE INDEX idx_tb1_16936_990012 ON tb1_20190801_990012 USING btree (c1)
 public     | tb1_20190901_990014 | idx_tb1234567890123456789012345678_16940_990014 |            | CREATE INDEX idx_tb1234567890123456789012345678_16940_990014 ON tb1_20190901_990014 USING btree (c1)
 public     | tb1_20190901_990014 | idx_tb1_16940_990014                            |            | CREATE INDEX idx_tb1_16940_990014 ON tb1_20190901_990014 USING btree (c1)
 public     | tb1_20191001_990016 | idx_tb1234567890123456789012345678_16944_990016 |            | CREATE INDEX idx_tb1234567890123456789012345678_16944_990016 ON tb1_20191001_990016 USING btree (c1)
 public     | tb1_20191001_990016 | idx_tb1_16944_990016                            |            | CREATE INDEX idx_tb1_16944_990016 ON tb1_20191001_990016 USING btree (c1)
 public     | tb1_20191101_990018 | idx_tb1234567890123456789012345678_16948_990018 |            | CREATE INDEX idx_tb1234567890123456789012345678_16948_990018 ON tb1_20191101_990018 USING btree (c1)
 public     | tb1_20191101_990018 | idx_tb1_16948_990018                            |            | CREATE INDEX idx_tb1_16948_990018 ON tb1_20191101_990018 USING btree (c1)
 public     | tb1_20191201_990020 | idx_tb1234567890123456789012345678_16952_990020 |            | CREATE INDEX idx_tb1234567890123456789012345678_16952_990020 ON tb1_20191201_990020 USING btree (c1)
 public     | tb1_20191201_990020 | idx_tb1_16952_990020                            |            | CREATE INDEX idx_tb1_16952_990020 ON tb1_20191201_990020 USING btree (c1)
(20 rows)


\c - - - :worker_2_port
select * from pg_indexes where schemaname='public' and tablename like 'tb1%' order by tablename, indexname;
 schemaname |      tablename      |                    indexname                    | tablespace |                                               indexdef                                               
------------+---------------------+-------------------------------------------------+------------+------------------------------------------------------------------------------------------------------
 public     | tb1_20190301_990003 | idx_tb1234567890123456789012345678_16916_990003 |            | CREATE INDEX idx_tb1234567890123456789012345678_16916_990003 ON tb1_20190301_990003 USING btree (c1)
 public     | tb1_20190301_990003 | idx_tb1_16916_990003                            |            | CREATE INDEX idx_tb1_16916_990003 ON tb1_20190301_990003 USING btree (c1)
 public     | tb1_20190401_990005 | idx_tb1234567890123456789012345678_16920_990005 |            | CREATE INDEX idx_tb1234567890123456789012345678_16920_990005 ON tb1_20190401_990005 USING btree (c1)
 public     | tb1_20190401_990005 | idx_tb1_16920_990005                            |            | CREATE INDEX idx_tb1_16920_990005 ON tb1_20190401_990005 USING btree (c1)
 public     | tb1_20190501_990007 | idx_tb1234567890123456789012345678_16924_990007 |            | CREATE INDEX idx_tb1234567890123456789012345678_16924_990007 ON tb1_20190501_990007 USING btree (c1)
 public     | tb1_20190501_990007 | idx_tb1_16924_990007                            |            | CREATE INDEX idx_tb1_16924_990007 ON tb1_20190501_990007 USING btree (c1)
 public     | tb1_20190601_990009 | idx_tb1234567890123456789012345678_16928_990009 |            | CREATE INDEX idx_tb1234567890123456789012345678_16928_990009 ON tb1_20190601_990009 USING btree (c1)
 public     | tb1_20190601_990009 | idx_tb1_16928_990009                            |            | CREATE INDEX idx_tb1_16928_990009 ON tb1_20190601_990009 USING btree (c1)
 public     | tb1_20190701_990011 | idx_tb1234567890123456789012345678_16932_990011 |            | CREATE INDEX idx_tb1234567890123456789012345678_16932_990011 ON tb1_20190701_990011 USING btree (c1)
 public     | tb1_20190701_990011 | idx_tb1_16932_990011                            |            | CREATE INDEX idx_tb1_16932_990011 ON tb1_20190701_990011 USING btree (c1)
 public     | tb1_20190801_990013 | idx_tb1234567890123456789012345678_16936_990013 |            | CREATE INDEX idx_tb1234567890123456789012345678_16936_990013 ON tb1_20190801_990013 USING btree (c1)
 public     | tb1_20190801_990013 | idx_tb1_16936_990013                            |            | CREATE INDEX idx_tb1_16936_990013 ON tb1_20190801_990013 USING btree (c1)
 public     | tb1_20190901_990015 | idx_tb1234567890123456789012345678_16940_990015 |            | CREATE INDEX idx_tb1234567890123456789012345678_16940_990015 ON tb1_20190901_990015 USING btree (c1)
 public     | tb1_20190901_990015 | idx_tb1_16940_990015                            |            | CREATE INDEX idx_tb1_16940_990015 ON tb1_20190901_990015 USING btree (c1)
 public     | tb1_20191001_990017 | idx_tb1234567890123456789012345678_16944_990017 |            | CREATE INDEX idx_tb1234567890123456789012345678_16944_990017 ON tb1_20191001_990017 USING btree (c1)
 public     | tb1_20191001_990017 | idx_tb1_16944_990017                            |            | CREATE INDEX idx_tb1_16944_990017 ON tb1_20191001_990017 USING btree (c1)
 public     | tb1_20191101_990019 | idx_tb1234567890123456789012345678_16948_990019 |            | CREATE INDEX idx_tb1234567890123456789012345678_16948_990019 ON tb1_20191101_990019 USING btree (c1)
 public     | tb1_20191101_990019 | idx_tb1_16948_990019                            |            | CREATE INDEX idx_tb1_16948_990019 ON tb1_20191101_990019 USING btree (c1)
 public     | tb1_20191201_990021 | idx_tb1234567890123456789012345678_16952_990021 |            | CREATE INDEX idx_tb1234567890123456789012345678_16952_990021 ON tb1_20191201_990021 USING btree (c1)
 public     | tb1_20191201_990021 | idx_tb1_16952_990021                            |            | CREATE INDEX idx_tb1_16952_990021 ON tb1_20191201_990021 USING btree (c1)
(20 rows)


\c - - - :master_port

-- 分区表添加索引（主键）
select rds.create_idx_on_parted_table('public.tb1', 'pk_idx_tb1', 'create unique index %i on %t(c1)', true);
                                                                                                      create_idx_on_parted_table                                                                                                       
---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
 ("select rds.func_create_idx_on_paritition('create unique index pk_idx_tb1_16916 on public.tb1_20190301(c1)','alter table public.tb1_20190301 add constraint pk_idx_tb1_16916 primary key using index pk_idx_tb1_16916')",success,"")
 ("select rds.func_create_idx_on_paritition('create unique index pk_idx_tb1_16920 on public.tb1_20190401(c1)','alter table public.tb1_20190401 add constraint pk_idx_tb1_16920 primary key using index pk_idx_tb1_16920')",success,"")
 ("select rds.func_create_idx_on_paritition('create unique index pk_idx_tb1_16924 on public.tb1_20190501(c1)','alter table public.tb1_20190501 add constraint pk_idx_tb1_16924 primary key using index pk_idx_tb1_16924')",success,"")
 ("select rds.func_create_idx_on_paritition('create unique index pk_idx_tb1_16928 on public.tb1_20190601(c1)','alter table public.tb1_20190601 add constraint pk_idx_tb1_16928 primary key using index pk_idx_tb1_16928')",success,"")
 ("select rds.func_create_idx_on_paritition('create unique index pk_idx_tb1_16932 on public.tb1_20190701(c1)','alter table public.tb1_20190701 add constraint pk_idx_tb1_16932 primary key using index pk_idx_tb1_16932')",success,"")
 ("select rds.func_create_idx_on_paritition('create unique index pk_idx_tb1_16936 on public.tb1_20190801(c1)','alter table public.tb1_20190801 add constraint pk_idx_tb1_16936 primary key using index pk_idx_tb1_16936')",success,"")
 ("select rds.func_create_idx_on_paritition('create unique index pk_idx_tb1_16940 on public.tb1_20190901(c1)','alter table public.tb1_20190901 add constraint pk_idx_tb1_16940 primary key using index pk_idx_tb1_16940')",success,"")
 ("select rds.func_create_idx_on_paritition('create unique index pk_idx_tb1_16944 on public.tb1_20191001(c1)','alter table public.tb1_20191001 add constraint pk_idx_tb1_16944 primary key using index pk_idx_tb1_16944')",success,"")
 ("select rds.func_create_idx_on_paritition('create unique index pk_idx_tb1_16948 on public.tb1_20191101(c1)','alter table public.tb1_20191101 add constraint pk_idx_tb1_16948 primary key using index pk_idx_tb1_16948')",success,"")
 ("select rds.func_create_idx_on_paritition('create unique index pk_idx_tb1_16952 on public.tb1_20191201(c1)','alter table public.tb1_20191201 add constraint pk_idx_tb1_16952 primary key using index pk_idx_tb1_16952')",success,"")
(10 rows)


-- 验证索引、主键
select * from pg_indexes where schemaname='public' and tablename like 'tb1%' order by tablename, indexname;
 schemaname |  tablename   |                indexname                 | tablespace |                                        indexdef                                        
------------+--------------+------------------------------------------+------------+----------------------------------------------------------------------------------------
 public     | tb1_20190301 | idx_tb1234567890123456789012345678_16916 |            | CREATE INDEX idx_tb1234567890123456789012345678_16916 ON tb1_20190301 USING btree (c1)
 public     | tb1_20190301 | idx_tb1_16916                            |            | CREATE INDEX idx_tb1_16916 ON tb1_20190301 USING btree (c1)
 public     | tb1_20190301 | pk_idx_tb1_16916                         |            | CREATE UNIQUE INDEX pk_idx_tb1_16916 ON tb1_20190301 USING btree (c1)
 public     | tb1_20190401 | idx_tb1234567890123456789012345678_16920 |            | CREATE INDEX idx_tb1234567890123456789012345678_16920 ON tb1_20190401 USING btree (c1)
 public     | tb1_20190401 | idx_tb1_16920                            |            | CREATE INDEX idx_tb1_16920 ON tb1_20190401 USING btree (c1)
 public     | tb1_20190401 | pk_idx_tb1_16920                         |            | CREATE UNIQUE INDEX pk_idx_tb1_16920 ON tb1_20190401 USING btree (c1)
 public     | tb1_20190501 | idx_tb1234567890123456789012345678_16924 |            | CREATE INDEX idx_tb1234567890123456789012345678_16924 ON tb1_20190501 USING btree (c1)
 public     | tb1_20190501 | idx_tb1_16924                            |            | CREATE INDEX idx_tb1_16924 ON tb1_20190501 USING btree (c1)
 public     | tb1_20190501 | pk_idx_tb1_16924                         |            | CREATE UNIQUE INDEX pk_idx_tb1_16924 ON tb1_20190501 USING btree (c1)
 public     | tb1_20190601 | idx_tb1234567890123456789012345678_16928 |            | CREATE INDEX idx_tb1234567890123456789012345678_16928 ON tb1_20190601 USING btree (c1)
 public     | tb1_20190601 | idx_tb1_16928                            |            | CREATE INDEX idx_tb1_16928 ON tb1_20190601 USING btree (c1)
 public     | tb1_20190601 | pk_idx_tb1_16928                         |            | CREATE UNIQUE INDEX pk_idx_tb1_16928 ON tb1_20190601 USING btree (c1)
 public     | tb1_20190701 | idx_tb1234567890123456789012345678_16932 |            | CREATE INDEX idx_tb1234567890123456789012345678_16932 ON tb1_20190701 USING btree (c1)
 public     | tb1_20190701 | idx_tb1_16932                            |            | CREATE INDEX idx_tb1_16932 ON tb1_20190701 USING btree (c1)
 public     | tb1_20190701 | pk_idx_tb1_16932                         |            | CREATE UNIQUE INDEX pk_idx_tb1_16932 ON tb1_20190701 USING btree (c1)
 public     | tb1_20190801 | idx_tb1234567890123456789012345678_16936 |            | CREATE INDEX idx_tb1234567890123456789012345678_16936 ON tb1_20190801 USING btree (c1)
 public     | tb1_20190801 | idx_tb1_16936                            |            | CREATE INDEX idx_tb1_16936 ON tb1_20190801 USING btree (c1)
 public     | tb1_20190801 | pk_idx_tb1_16936                         |            | CREATE UNIQUE INDEX pk_idx_tb1_16936 ON tb1_20190801 USING btree (c1)
 public     | tb1_20190901 | idx_tb1234567890123456789012345678_16940 |            | CREATE INDEX idx_tb1234567890123456789012345678_16940 ON tb1_20190901 USING btree (c1)
 public     | tb1_20190901 | idx_tb1_16940                            |            | CREATE INDEX idx_tb1_16940 ON tb1_20190901 USING btree (c1)
 public     | tb1_20190901 | pk_idx_tb1_16940                         |            | CREATE UNIQUE INDEX pk_idx_tb1_16940 ON tb1_20190901 USING btree (c1)
 public     | tb1_20191001 | idx_tb1234567890123456789012345678_16944 |            | CREATE INDEX idx_tb1234567890123456789012345678_16944 ON tb1_20191001 USING btree (c1)
 public     | tb1_20191001 | idx_tb1_16944                            |            | CREATE INDEX idx_tb1_16944 ON tb1_20191001 USING btree (c1)
 public     | tb1_20191001 | pk_idx_tb1_16944                         |            | CREATE UNIQUE INDEX pk_idx_tb1_16944 ON tb1_20191001 USING btree (c1)
 public     | tb1_20191101 | idx_tb1234567890123456789012345678_16948 |            | CREATE INDEX idx_tb1234567890123456789012345678_16948 ON tb1_20191101 USING btree (c1)
 public     | tb1_20191101 | idx_tb1_16948                            |            | CREATE INDEX idx_tb1_16948 ON tb1_20191101 USING btree (c1)
 public     | tb1_20191101 | pk_idx_tb1_16948                         |            | CREATE UNIQUE INDEX pk_idx_tb1_16948 ON tb1_20191101 USING btree (c1)
 public     | tb1_20191201 | idx_tb1234567890123456789012345678_16952 |            | CREATE INDEX idx_tb1234567890123456789012345678_16952 ON tb1_20191201 USING btree (c1)
 public     | tb1_20191201 | idx_tb1_16952                            |            | CREATE INDEX idx_tb1_16952 ON tb1_20191201 USING btree (c1)
 public     | tb1_20191201 | pk_idx_tb1_16952                         |            | CREATE UNIQUE INDEX pk_idx_tb1_16952 ON tb1_20191201 USING btree (c1)
(30 rows)

select * from rds.user_tab_part_indexes_def;
 tab_name |              idx_name              |             idx_sql              | is_pkey 
----------+------------------------------------+----------------------------------+---------
 tb1      | idx_tb1                            | create index    %i on   %t(c1)   | f
 tb1      | idx_tb1234567890123456789012345678 | create index %i on %t(c1)        | f
 tb1      | pk_idx_tb1                         | create unique index %i on %t(c1) | t
(3 rows)

select * from pg_constraint where conname like 'pk_idx_tb1%' order by conname;
     conname      | connamespace | contype | condeferrable | condeferred | convalidated | conrelid | contypid | conindid | confrelid | confupdtype | confdeltype | confmatchtype | conislocal | coninhcount | connoinherit | conkey | confkey | conpfeqop | conppeqop | conffeqop | conexclop | conbin | consrc 
------------------+--------------+---------+---------------+-------------+--------------+----------+----------+----------+-----------+-------------+-------------+---------------+------------+-------------+--------------+--------+---------+-----------+-----------+-----------+-----------+--------+--------
 pk_idx_tb1_16916 |         2200 | p       | f             | f           | t            |    16916 |        0 |    16976 |         0 |             |             |               | t          |           0 | t            | {1}    |         |           |           |           |           |        | 
 pk_idx_tb1_16920 |         2200 | p       | f             | f           | t            |    16920 |        0 |    16978 |         0 |             |             |               | t          |           0 | t            | {1}    |         |           |           |           |           |        | 
 pk_idx_tb1_16924 |         2200 | p       | f             | f           | t            |    16924 |        0 |    16980 |         0 |             |             |               | t          |           0 | t            | {1}    |         |           |           |           |           |        | 
 pk_idx_tb1_16928 |         2200 | p       | f             | f           | t            |    16928 |        0 |    16982 |         0 |             |             |               | t          |           0 | t            | {1}    |         |           |           |           |           |        | 
 pk_idx_tb1_16932 |         2200 | p       | f             | f           | t            |    16932 |        0 |    16984 |         0 |             |             |               | t          |           0 | t            | {1}    |         |           |           |           |           |        | 
 pk_idx_tb1_16936 |         2200 | p       | f             | f           | t            |    16936 |        0 |    16986 |         0 |             |             |               | t          |           0 | t            | {1}    |         |           |           |           |           |        | 
 pk_idx_tb1_16940 |         2200 | p       | f             | f           | t            |    16940 |        0 |    16988 |         0 |             |             |               | t          |           0 | t            | {1}    |         |           |           |           |           |        | 
 pk_idx_tb1_16944 |         2200 | p       | f             | f           | t            |    16944 |        0 |    16990 |         0 |             |             |               | t          |           0 | t            | {1}    |         |           |           |           |           |        | 
 pk_idx_tb1_16948 |         2200 | p       | f             | f           | t            |    16948 |        0 |    16992 |         0 |             |             |               | t          |           0 | t            | {1}    |         |           |           |           |           |        | 
 pk_idx_tb1_16952 |         2200 | p       | f             | f           | t            |    16952 |        0 |    16994 |         0 |             |             |               | t          |           0 | t            | {1}    |         |           |           |           |           |        | 
(10 rows)


\c - - - :worker_1_port
select * from pg_indexes where schemaname='public' and tablename like 'tb1%' order by tablename, indexname;
 schemaname |      tablename      |                    indexname                    | tablespace |                                               indexdef                                               
------------+---------------------+-------------------------------------------------+------------+------------------------------------------------------------------------------------------------------
 public     | tb1_20190301_990002 | idx_tb1234567890123456789012345678_16916_990002 |            | CREATE INDEX idx_tb1234567890123456789012345678_16916_990002 ON tb1_20190301_990002 USING btree (c1)
 public     | tb1_20190301_990002 | idx_tb1_16916_990002                            |            | CREATE INDEX idx_tb1_16916_990002 ON tb1_20190301_990002 USING btree (c1)
 public     | tb1_20190301_990002 | pk_idx_tb1_16916_990002                         |            | CREATE UNIQUE INDEX pk_idx_tb1_16916_990002 ON tb1_20190301_990002 USING btree (c1)
 public     | tb1_20190401_990004 | idx_tb1234567890123456789012345678_16920_990004 |            | CREATE INDEX idx_tb1234567890123456789012345678_16920_990004 ON tb1_20190401_990004 USING btree (c1)
 public     | tb1_20190401_990004 | idx_tb1_16920_990004                            |            | CREATE INDEX idx_tb1_16920_990004 ON tb1_20190401_990004 USING btree (c1)
 public     | tb1_20190401_990004 | pk_idx_tb1_16920_990004                         |            | CREATE UNIQUE INDEX pk_idx_tb1_16920_990004 ON tb1_20190401_990004 USING btree (c1)
 public     | tb1_20190501_990006 | idx_tb1234567890123456789012345678_16924_990006 |            | CREATE INDEX idx_tb1234567890123456789012345678_16924_990006 ON tb1_20190501_990006 USING btree (c1)
 public     | tb1_20190501_990006 | idx_tb1_16924_990006                            |            | CREATE INDEX idx_tb1_16924_990006 ON tb1_20190501_990006 USING btree (c1)
 public     | tb1_20190501_990006 | pk_idx_tb1_16924_990006                         |            | CREATE UNIQUE INDEX pk_idx_tb1_16924_990006 ON tb1_20190501_990006 USING btree (c1)
 public     | tb1_20190601_990008 | idx_tb1234567890123456789012345678_16928_990008 |            | CREATE INDEX idx_tb1234567890123456789012345678_16928_990008 ON tb1_20190601_990008 USING btree (c1)
 public     | tb1_20190601_990008 | idx_tb1_16928_990008                            |            | CREATE INDEX idx_tb1_16928_990008 ON tb1_20190601_990008 USING btree (c1)
 public     | tb1_20190601_990008 | pk_idx_tb1_16928_990008                         |            | CREATE UNIQUE INDEX pk_idx_tb1_16928_990008 ON tb1_20190601_990008 USING btree (c1)
 public     | tb1_20190701_990010 | idx_tb1234567890123456789012345678_16932_990010 |            | CREATE INDEX idx_tb1234567890123456789012345678_16932_990010 ON tb1_20190701_990010 USING btree (c1)
 public     | tb1_20190701_990010 | idx_tb1_16932_990010                            |            | CREATE INDEX idx_tb1_16932_990010 ON tb1_20190701_990010 USING btree (c1)
 public     | tb1_20190701_990010 | pk_idx_tb1_16932_990010                         |            | CREATE UNIQUE INDEX pk_idx_tb1_16932_990010 ON tb1_20190701_990010 USING btree (c1)
 public     | tb1_20190801_990012 | idx_tb1234567890123456789012345678_16936_990012 |            | CREATE INDEX idx_tb1234567890123456789012345678_16936_990012 ON tb1_20190801_990012 USING btree (c1)
 public     | tb1_20190801_990012 | idx_tb1_16936_990012                            |            | CREATE INDEX idx_tb1_16936_990012 ON tb1_20190801_990012 USING btree (c1)
 public     | tb1_20190801_990012 | pk_idx_tb1_16936_990012                         |            | CREATE UNIQUE INDEX pk_idx_tb1_16936_990012 ON tb1_20190801_990012 USING btree (c1)
 public     | tb1_20190901_990014 | idx_tb1234567890123456789012345678_16940_990014 |            | CREATE INDEX idx_tb1234567890123456789012345678_16940_990014 ON tb1_20190901_990014 USING btree (c1)
 public     | tb1_20190901_990014 | idx_tb1_16940_990014                            |            | CREATE INDEX idx_tb1_16940_990014 ON tb1_20190901_990014 USING btree (c1)
 public     | tb1_20190901_990014 | pk_idx_tb1_16940_990014                         |            | CREATE UNIQUE INDEX pk_idx_tb1_16940_990014 ON tb1_20190901_990014 USING btree (c1)
 public     | tb1_20191001_990016 | idx_tb1234567890123456789012345678_16944_990016 |            | CREATE INDEX idx_tb1234567890123456789012345678_16944_990016 ON tb1_20191001_990016 USING btree (c1)
 public     | tb1_20191001_990016 | idx_tb1_16944_990016                            |            | CREATE INDEX idx_tb1_16944_990016 ON tb1_20191001_990016 USING btree (c1)
 public     | tb1_20191001_990016 | pk_idx_tb1_16944_990016                         |            | CREATE UNIQUE INDEX pk_idx_tb1_16944_990016 ON tb1_20191001_990016 USING btree (c1)
 public     | tb1_20191101_990018 | idx_tb1234567890123456789012345678_16948_990018 |            | CREATE INDEX idx_tb1234567890123456789012345678_16948_990018 ON tb1_20191101_990018 USING btree (c1)
 public     | tb1_20191101_990018 | idx_tb1_16948_990018                            |            | CREATE INDEX idx_tb1_16948_990018 ON tb1_20191101_990018 USING btree (c1)
 public     | tb1_20191101_990018 | pk_idx_tb1_16948_990018                         |            | CREATE UNIQUE INDEX pk_idx_tb1_16948_990018 ON tb1_20191101_990018 USING btree (c1)
 public     | tb1_20191201_990020 | idx_tb1234567890123456789012345678_16952_990020 |            | CREATE INDEX idx_tb1234567890123456789012345678_16952_990020 ON tb1_20191201_990020 USING btree (c1)
 public     | tb1_20191201_990020 | idx_tb1_16952_990020                            |            | CREATE INDEX idx_tb1_16952_990020 ON tb1_20191201_990020 USING btree (c1)
 public     | tb1_20191201_990020 | pk_idx_tb1_16952_990020                         |            | CREATE UNIQUE INDEX pk_idx_tb1_16952_990020 ON tb1_20191201_990020 USING btree (c1)
(30 rows)

select * from pg_constraint where conname like 'pk_idx_tb1%' order by conname;
         conname         | connamespace | contype | condeferrable | condeferred | convalidated | conrelid | contypid | conindid | confrelid | confupdtype | confdeltype | confmatchtype | conislocal | coninhcount | connoinherit | conkey | confkey | conpfeqop | conppeqop | conffeqop | conexclop | conbin | consrc 
-------------------------+--------------+---------+---------------+-------------+--------------+----------+----------+----------+-----------+-------------+-------------+---------------+------------+-------------+--------------+--------+---------+-----------+-----------+-----------+-----------+--------+--------
 pk_idx_tb1_16916_990002 |         2200 | p       | f             | f           | t            |    16846 |        0 |    16896 |         0 |             |             |               | t          |           0 | t            | {1}    |         |           |           |           |           |        | 
 pk_idx_tb1_16920_990004 |         2200 | p       | f             | f           | t            |    16849 |        0 |    16898 |         0 |             |             |               | t          |           0 | t            | {1}    |         |           |           |           |           |        | 
 pk_idx_tb1_16924_990006 |         2200 | p       | f             | f           | t            |    16852 |        0 |    16900 |         0 |             |             |               | t          |           0 | t            | {1}    |         |           |           |           |           |        | 
 pk_idx_tb1_16928_990008 |         2200 | p       | f             | f           | t            |    16855 |        0 |    16902 |         0 |             |             |               | t          |           0 | t            | {1}    |         |           |           |           |           |        | 
 pk_idx_tb1_16932_990010 |         2200 | p       | f             | f           | t            |    16858 |        0 |    16904 |         0 |             |             |               | t          |           0 | t            | {1}    |         |           |           |           |           |        | 
 pk_idx_tb1_16936_990012 |         2200 | p       | f             | f           | t            |    16861 |        0 |    16906 |         0 |             |             |               | t          |           0 | t            | {1}    |         |           |           |           |           |        | 
 pk_idx_tb1_16940_990014 |         2200 | p       | f             | f           | t            |    16864 |        0 |    16908 |         0 |             |             |               | t          |           0 | t            | {1}    |         |           |           |           |           |        | 
 pk_idx_tb1_16944_990016 |         2200 | p       | f             | f           | t            |    16867 |        0 |    16910 |         0 |             |             |               | t          |           0 | t            | {1}    |         |           |           |           |           |        | 
 pk_idx_tb1_16948_990018 |         2200 | p       | f             | f           | t            |    16870 |        0 |    16912 |         0 |             |             |               | t          |           0 | t            | {1}    |         |           |           |           |           |        | 
 pk_idx_tb1_16952_990020 |         2200 | p       | f             | f           | t            |    16873 |        0 |    16914 |         0 |             |             |               | t          |           0 | t            | {1}    |         |           |           |           |           |        | 
(10 rows)


\c - - - :worker_2_port
select * from pg_indexes where schemaname='public' and tablename like 'tb1%' order by tablename, indexname;
 schemaname |      tablename      |                    indexname                    | tablespace |                                               indexdef                                               
------------+---------------------+-------------------------------------------------+------------+------------------------------------------------------------------------------------------------------
 public     | tb1_20190301_990003 | idx_tb1234567890123456789012345678_16916_990003 |            | CREATE INDEX idx_tb1234567890123456789012345678_16916_990003 ON tb1_20190301_990003 USING btree (c1)
 public     | tb1_20190301_990003 | idx_tb1_16916_990003                            |            | CREATE INDEX idx_tb1_16916_990003 ON tb1_20190301_990003 USING btree (c1)
 public     | tb1_20190301_990003 | pk_idx_tb1_16916_990003                         |            | CREATE UNIQUE INDEX pk_idx_tb1_16916_990003 ON tb1_20190301_990003 USING btree (c1)
 public     | tb1_20190401_990005 | idx_tb1234567890123456789012345678_16920_990005 |            | CREATE INDEX idx_tb1234567890123456789012345678_16920_990005 ON tb1_20190401_990005 USING btree (c1)
 public     | tb1_20190401_990005 | idx_tb1_16920_990005                            |            | CREATE INDEX idx_tb1_16920_990005 ON tb1_20190401_990005 USING btree (c1)
 public     | tb1_20190401_990005 | pk_idx_tb1_16920_990005                         |            | CREATE UNIQUE INDEX pk_idx_tb1_16920_990005 ON tb1_20190401_990005 USING btree (c1)
 public     | tb1_20190501_990007 | idx_tb1234567890123456789012345678_16924_990007 |            | CREATE INDEX idx_tb1234567890123456789012345678_16924_990007 ON tb1_20190501_990007 USING btree (c1)
 public     | tb1_20190501_990007 | idx_tb1_16924_990007                            |            | CREATE INDEX idx_tb1_16924_990007 ON tb1_20190501_990007 USING btree (c1)
 public     | tb1_20190501_990007 | pk_idx_tb1_16924_990007                         |            | CREATE UNIQUE INDEX pk_idx_tb1_16924_990007 ON tb1_20190501_990007 USING btree (c1)
 public     | tb1_20190601_990009 | idx_tb1234567890123456789012345678_16928_990009 |            | CREATE INDEX idx_tb1234567890123456789012345678_16928_990009 ON tb1_20190601_990009 USING btree (c1)
 public     | tb1_20190601_990009 | idx_tb1_16928_990009                            |            | CREATE INDEX idx_tb1_16928_990009 ON tb1_20190601_990009 USING btree (c1)
 public     | tb1_20190601_990009 | pk_idx_tb1_16928_990009                         |            | CREATE UNIQUE INDEX pk_idx_tb1_16928_990009 ON tb1_20190601_990009 USING btree (c1)
 public     | tb1_20190701_990011 | idx_tb1234567890123456789012345678_16932_990011 |            | CREATE INDEX idx_tb1234567890123456789012345678_16932_990011 ON tb1_20190701_990011 USING btree (c1)
 public     | tb1_20190701_990011 | idx_tb1_16932_990011                            |            | CREATE INDEX idx_tb1_16932_990011 ON tb1_20190701_990011 USING btree (c1)
 public     | tb1_20190701_990011 | pk_idx_tb1_16932_990011                         |            | CREATE UNIQUE INDEX pk_idx_tb1_16932_990011 ON tb1_20190701_990011 USING btree (c1)
 public     | tb1_20190801_990013 | idx_tb1234567890123456789012345678_16936_990013 |            | CREATE INDEX idx_tb1234567890123456789012345678_16936_990013 ON tb1_20190801_990013 USING btree (c1)
 public     | tb1_20190801_990013 | idx_tb1_16936_990013                            |            | CREATE INDEX idx_tb1_16936_990013 ON tb1_20190801_990013 USING btree (c1)
 public     | tb1_20190801_990013 | pk_idx_tb1_16936_990013                         |            | CREATE UNIQUE INDEX pk_idx_tb1_16936_990013 ON tb1_20190801_990013 USING btree (c1)
 public     | tb1_20190901_990015 | idx_tb1234567890123456789012345678_16940_990015 |            | CREATE INDEX idx_tb1234567890123456789012345678_16940_990015 ON tb1_20190901_990015 USING btree (c1)
 public     | tb1_20190901_990015 | idx_tb1_16940_990015                            |            | CREATE INDEX idx_tb1_16940_990015 ON tb1_20190901_990015 USING btree (c1)
 public     | tb1_20190901_990015 | pk_idx_tb1_16940_990015                         |            | CREATE UNIQUE INDEX pk_idx_tb1_16940_990015 ON tb1_20190901_990015 USING btree (c1)
 public     | tb1_20191001_990017 | idx_tb1234567890123456789012345678_16944_990017 |            | CREATE INDEX idx_tb1234567890123456789012345678_16944_990017 ON tb1_20191001_990017 USING btree (c1)
 public     | tb1_20191001_990017 | idx_tb1_16944_990017                            |            | CREATE INDEX idx_tb1_16944_990017 ON tb1_20191001_990017 USING btree (c1)
 public     | tb1_20191001_990017 | pk_idx_tb1_16944_990017                         |            | CREATE UNIQUE INDEX pk_idx_tb1_16944_990017 ON tb1_20191001_990017 USING btree (c1)
 public     | tb1_20191101_990019 | idx_tb1234567890123456789012345678_16948_990019 |            | CREATE INDEX idx_tb1234567890123456789012345678_16948_990019 ON tb1_20191101_990019 USING btree (c1)
 public     | tb1_20191101_990019 | idx_tb1_16948_990019                            |            | CREATE INDEX idx_tb1_16948_990019 ON tb1_20191101_990019 USING btree (c1)
 public     | tb1_20191101_990019 | pk_idx_tb1_16948_990019                         |            | CREATE UNIQUE INDEX pk_idx_tb1_16948_990019 ON tb1_20191101_990019 USING btree (c1)
 public     | tb1_20191201_990021 | idx_tb1234567890123456789012345678_16952_990021 |            | CREATE INDEX idx_tb1234567890123456789012345678_16952_990021 ON tb1_20191201_990021 USING btree (c1)
 public     | tb1_20191201_990021 | idx_tb1_16952_990021                            |            | CREATE INDEX idx_tb1_16952_990021 ON tb1_20191201_990021 USING btree (c1)
 public     | tb1_20191201_990021 | pk_idx_tb1_16952_990021                         |            | CREATE UNIQUE INDEX pk_idx_tb1_16952_990021 ON tb1_20191201_990021 USING btree (c1)
(30 rows)

select * from pg_constraint where conname like 'pk_idx_tb1%' order by conname;
         conname         | connamespace | contype | condeferrable | condeferred | convalidated | conrelid | contypid | conindid | confrelid | confupdtype | confdeltype | confmatchtype | conislocal | coninhcount | connoinherit | conkey | confkey | conpfeqop | conppeqop | conffeqop | conexclop | conbin | consrc 
-------------------------+--------------+---------+---------------+-------------+--------------+----------+----------+----------+-----------+-------------+-------------+---------------+------------+-------------+--------------+--------+---------+-----------+-----------+-----------+-----------+--------+--------
 pk_idx_tb1_16916_990003 |         2200 | p       | f             | f           | t            |    16846 |        0 |    16896 |         0 |             |             |               | t          |           0 | t            | {1}    |         |           |           |           |           |        | 
 pk_idx_tb1_16920_990005 |         2200 | p       | f             | f           | t            |    16849 |        0 |    16898 |         0 |             |             |               | t          |           0 | t            | {1}    |         |           |           |           |           |        | 
 pk_idx_tb1_16924_990007 |         2200 | p       | f             | f           | t            |    16852 |        0 |    16900 |         0 |             |             |               | t          |           0 | t            | {1}    |         |           |           |           |           |        | 
 pk_idx_tb1_16928_990009 |         2200 | p       | f             | f           | t            |    16855 |        0 |    16902 |         0 |             |             |               | t          |           0 | t            | {1}    |         |           |           |           |           |        | 
 pk_idx_tb1_16932_990011 |         2200 | p       | f             | f           | t            |    16858 |        0 |    16904 |         0 |             |             |               | t          |           0 | t            | {1}    |         |           |           |           |           |        | 
 pk_idx_tb1_16936_990013 |         2200 | p       | f             | f           | t            |    16861 |        0 |    16906 |         0 |             |             |               | t          |           0 | t            | {1}    |         |           |           |           |           |        | 
 pk_idx_tb1_16940_990015 |         2200 | p       | f             | f           | t            |    16864 |        0 |    16908 |         0 |             |             |               | t          |           0 | t            | {1}    |         |           |           |           |           |        | 
 pk_idx_tb1_16944_990017 |         2200 | p       | f             | f           | t            |    16867 |        0 |    16910 |         0 |             |             |               | t          |           0 | t            | {1}    |         |           |           |           |           |        | 
 pk_idx_tb1_16948_990019 |         2200 | p       | f             | f           | t            |    16870 |        0 |    16912 |         0 |             |             |               | t          |           0 | t            | {1}    |         |           |           |           |           |        | 
 pk_idx_tb1_16952_990021 |         2200 | p       | f             | f           | t            |    16873 |        0 |    16914 |         0 |             |             |               | t          |           0 | t            | {1}    |         |           |           |           |           |        | 
(10 rows)


\c - - - :master_port

-- 分区单独添加索引
create index idx_tb1_test on public.tb1_20190501(c1);
ERROR:  Creating an index directly on a table partition is not allowed, please invoke create_idx_on_parted_table to do this.
CONTEXT:  PL/pgSQL function rds.func_ddl_command_start() line 75 at RAISE

-- 验证索引
select * from pg_indexes where schemaname='public' and tablename like 'tb1%' order by tablename, indexname;
 schemaname |  tablename   |                indexname                 | tablespace |                                        indexdef                                        
------------+--------------+------------------------------------------+------------+----------------------------------------------------------------------------------------
 public     | tb1_20190301 | idx_tb1234567890123456789012345678_16916 |            | CREATE INDEX idx_tb1234567890123456789012345678_16916 ON tb1_20190301 USING btree (c1)
 public     | tb1_20190301 | idx_tb1_16916                            |            | CREATE INDEX idx_tb1_16916 ON tb1_20190301 USING btree (c1)
 public     | tb1_20190301 | pk_idx_tb1_16916                         |            | CREATE UNIQUE INDEX pk_idx_tb1_16916 ON tb1_20190301 USING btree (c1)
 public     | tb1_20190401 | idx_tb1234567890123456789012345678_16920 |            | CREATE INDEX idx_tb1234567890123456789012345678_16920 ON tb1_20190401 USING btree (c1)
 public     | tb1_20190401 | idx_tb1_16920                            |            | CREATE INDEX idx_tb1_16920 ON tb1_20190401 USING btree (c1)
 public     | tb1_20190401 | pk_idx_tb1_16920                         |            | CREATE UNIQUE INDEX pk_idx_tb1_16920 ON tb1_20190401 USING btree (c1)
 public     | tb1_20190501 | idx_tb1234567890123456789012345678_16924 |            | CREATE INDEX idx_tb1234567890123456789012345678_16924 ON tb1_20190501 USING btree (c1)
 public     | tb1_20190501 | idx_tb1_16924                            |            | CREATE INDEX idx_tb1_16924 ON tb1_20190501 USING btree (c1)
 public     | tb1_20190501 | pk_idx_tb1_16924                         |            | CREATE UNIQUE INDEX pk_idx_tb1_16924 ON tb1_20190501 USING btree (c1)
 public     | tb1_20190601 | idx_tb1234567890123456789012345678_16928 |            | CREATE INDEX idx_tb1234567890123456789012345678_16928 ON tb1_20190601 USING btree (c1)
 public     | tb1_20190601 | idx_tb1_16928                            |            | CREATE INDEX idx_tb1_16928 ON tb1_20190601 USING btree (c1)
 public     | tb1_20190601 | pk_idx_tb1_16928                         |            | CREATE UNIQUE INDEX pk_idx_tb1_16928 ON tb1_20190601 USING btree (c1)
 public     | tb1_20190701 | idx_tb1234567890123456789012345678_16932 |            | CREATE INDEX idx_tb1234567890123456789012345678_16932 ON tb1_20190701 USING btree (c1)
 public     | tb1_20190701 | idx_tb1_16932                            |            | CREATE INDEX idx_tb1_16932 ON tb1_20190701 USING btree (c1)
 public     | tb1_20190701 | pk_idx_tb1_16932                         |            | CREATE UNIQUE INDEX pk_idx_tb1_16932 ON tb1_20190701 USING btree (c1)
 public     | tb1_20190801 | idx_tb1234567890123456789012345678_16936 |            | CREATE INDEX idx_tb1234567890123456789012345678_16936 ON tb1_20190801 USING btree (c1)
 public     | tb1_20190801 | idx_tb1_16936                            |            | CREATE INDEX idx_tb1_16936 ON tb1_20190801 USING btree (c1)
 public     | tb1_20190801 | pk_idx_tb1_16936                         |            | CREATE UNIQUE INDEX pk_idx_tb1_16936 ON tb1_20190801 USING btree (c1)
 public     | tb1_20190901 | idx_tb1234567890123456789012345678_16940 |            | CREATE INDEX idx_tb1234567890123456789012345678_16940 ON tb1_20190901 USING btree (c1)
 public     | tb1_20190901 | idx_tb1_16940                            |            | CREATE INDEX idx_tb1_16940 ON tb1_20190901 USING btree (c1)
 public     | tb1_20190901 | pk_idx_tb1_16940                         |            | CREATE UNIQUE INDEX pk_idx_tb1_16940 ON tb1_20190901 USING btree (c1)
 public     | tb1_20191001 | idx_tb1234567890123456789012345678_16944 |            | CREATE INDEX idx_tb1234567890123456789012345678_16944 ON tb1_20191001 USING btree (c1)
 public     | tb1_20191001 | idx_tb1_16944                            |            | CREATE INDEX idx_tb1_16944 ON tb1_20191001 USING btree (c1)
 public     | tb1_20191001 | pk_idx_tb1_16944                         |            | CREATE UNIQUE INDEX pk_idx_tb1_16944 ON tb1_20191001 USING btree (c1)
 public     | tb1_20191101 | idx_tb1234567890123456789012345678_16948 |            | CREATE INDEX idx_tb1234567890123456789012345678_16948 ON tb1_20191101 USING btree (c1)
 public     | tb1_20191101 | idx_tb1_16948                            |            | CREATE INDEX idx_tb1_16948 ON tb1_20191101 USING btree (c1)
 public     | tb1_20191101 | pk_idx_tb1_16948                         |            | CREATE UNIQUE INDEX pk_idx_tb1_16948 ON tb1_20191101 USING btree (c1)
 public     | tb1_20191201 | idx_tb1234567890123456789012345678_16952 |            | CREATE INDEX idx_tb1234567890123456789012345678_16952 ON tb1_20191201 USING btree (c1)
 public     | tb1_20191201 | idx_tb1_16952                            |            | CREATE INDEX idx_tb1_16952 ON tb1_20191201 USING btree (c1)
 public     | tb1_20191201 | pk_idx_tb1_16952                         |            | CREATE UNIQUE INDEX pk_idx_tb1_16952 ON tb1_20191201 USING btree (c1)
(30 rows)

select * from rds.user_tab_part_indexes_def;
 tab_name |              idx_name              |             idx_sql              | is_pkey 
----------+------------------------------------+----------------------------------+---------
 tb1      | idx_tb1                            | create index    %i on   %t(c1)   | f
 tb1      | idx_tb1234567890123456789012345678 | create index %i on %t(c1)        | f
 tb1      | pk_idx_tb1                         | create unique index %i on %t(c1) | t
(3 rows)


\c - - - :worker_1_port
select * from pg_indexes where schemaname='public' and tablename like 'tb1%' order by tablename, indexname;
 schemaname |      tablename      |                    indexname                    | tablespace |                                               indexdef                                               
------------+---------------------+-------------------------------------------------+------------+------------------------------------------------------------------------------------------------------
 public     | tb1_20190301_990002 | idx_tb1234567890123456789012345678_16916_990002 |            | CREATE INDEX idx_tb1234567890123456789012345678_16916_990002 ON tb1_20190301_990002 USING btree (c1)
 public     | tb1_20190301_990002 | idx_tb1_16916_990002                            |            | CREATE INDEX idx_tb1_16916_990002 ON tb1_20190301_990002 USING btree (c1)
 public     | tb1_20190301_990002 | pk_idx_tb1_16916_990002                         |            | CREATE UNIQUE INDEX pk_idx_tb1_16916_990002 ON tb1_20190301_990002 USING btree (c1)
 public     | tb1_20190401_990004 | idx_tb1234567890123456789012345678_16920_990004 |            | CREATE INDEX idx_tb1234567890123456789012345678_16920_990004 ON tb1_20190401_990004 USING btree (c1)
 public     | tb1_20190401_990004 | idx_tb1_16920_990004                            |            | CREATE INDEX idx_tb1_16920_990004 ON tb1_20190401_990004 USING btree (c1)
 public     | tb1_20190401_990004 | pk_idx_tb1_16920_990004                         |            | CREATE UNIQUE INDEX pk_idx_tb1_16920_990004 ON tb1_20190401_990004 USING btree (c1)
 public     | tb1_20190501_990006 | idx_tb1234567890123456789012345678_16924_990006 |            | CREATE INDEX idx_tb1234567890123456789012345678_16924_990006 ON tb1_20190501_990006 USING btree (c1)
 public     | tb1_20190501_990006 | idx_tb1_16924_990006                            |            | CREATE INDEX idx_tb1_16924_990006 ON tb1_20190501_990006 USING btree (c1)
 public     | tb1_20190501_990006 | pk_idx_tb1_16924_990006                         |            | CREATE UNIQUE INDEX pk_idx_tb1_16924_990006 ON tb1_20190501_990006 USING btree (c1)
 public     | tb1_20190601_990008 | idx_tb1234567890123456789012345678_16928_990008 |            | CREATE INDEX idx_tb1234567890123456789012345678_16928_990008 ON tb1_20190601_990008 USING btree (c1)
 public     | tb1_20190601_990008 | idx_tb1_16928_990008                            |            | CREATE INDEX idx_tb1_16928_990008 ON tb1_20190601_990008 USING btree (c1)
 public     | tb1_20190601_990008 | pk_idx_tb1_16928_990008                         |            | CREATE UNIQUE INDEX pk_idx_tb1_16928_990008 ON tb1_20190601_990008 USING btree (c1)
 public     | tb1_20190701_990010 | idx_tb1234567890123456789012345678_16932_990010 |            | CREATE INDEX idx_tb1234567890123456789012345678_16932_990010 ON tb1_20190701_990010 USING btree (c1)
 public     | tb1_20190701_990010 | idx_tb1_16932_990010                            |            | CREATE INDEX idx_tb1_16932_990010 ON tb1_20190701_990010 USING btree (c1)
 public     | tb1_20190701_990010 | pk_idx_tb1_16932_990010                         |            | CREATE UNIQUE INDEX pk_idx_tb1_16932_990010 ON tb1_20190701_990010 USING btree (c1)
 public     | tb1_20190801_990012 | idx_tb1234567890123456789012345678_16936_990012 |            | CREATE INDEX idx_tb1234567890123456789012345678_16936_990012 ON tb1_20190801_990012 USING btree (c1)
 public     | tb1_20190801_990012 | idx_tb1_16936_990012                            |            | CREATE INDEX idx_tb1_16936_990012 ON tb1_20190801_990012 USING btree (c1)
 public     | tb1_20190801_990012 | pk_idx_tb1_16936_990012                         |            | CREATE UNIQUE INDEX pk_idx_tb1_16936_990012 ON tb1_20190801_990012 USING btree (c1)
 public     | tb1_20190901_990014 | idx_tb1234567890123456789012345678_16940_990014 |            | CREATE INDEX idx_tb1234567890123456789012345678_16940_990014 ON tb1_20190901_990014 USING btree (c1)
 public     | tb1_20190901_990014 | idx_tb1_16940_990014                            |            | CREATE INDEX idx_tb1_16940_990014 ON tb1_20190901_990014 USING btree (c1)
 public     | tb1_20190901_990014 | pk_idx_tb1_16940_990014                         |            | CREATE UNIQUE INDEX pk_idx_tb1_16940_990014 ON tb1_20190901_990014 USING btree (c1)
 public     | tb1_20191001_990016 | idx_tb1234567890123456789012345678_16944_990016 |            | CREATE INDEX idx_tb1234567890123456789012345678_16944_990016 ON tb1_20191001_990016 USING btree (c1)
 public     | tb1_20191001_990016 | idx_tb1_16944_990016                            |            | CREATE INDEX idx_tb1_16944_990016 ON tb1_20191001_990016 USING btree (c1)
 public     | tb1_20191001_990016 | pk_idx_tb1_16944_990016                         |            | CREATE UNIQUE INDEX pk_idx_tb1_16944_990016 ON tb1_20191001_990016 USING btree (c1)
 public     | tb1_20191101_990018 | idx_tb1234567890123456789012345678_16948_990018 |            | CREATE INDEX idx_tb1234567890123456789012345678_16948_990018 ON tb1_20191101_990018 USING btree (c1)
 public     | tb1_20191101_990018 | idx_tb1_16948_990018                            |            | CREATE INDEX idx_tb1_16948_990018 ON tb1_20191101_990018 USING btree (c1)
 public     | tb1_20191101_990018 | pk_idx_tb1_16948_990018                         |            | CREATE UNIQUE INDEX pk_idx_tb1_16948_990018 ON tb1_20191101_990018 USING btree (c1)
 public     | tb1_20191201_990020 | idx_tb1234567890123456789012345678_16952_990020 |            | CREATE INDEX idx_tb1234567890123456789012345678_16952_990020 ON tb1_20191201_990020 USING btree (c1)
 public     | tb1_20191201_990020 | idx_tb1_16952_990020                            |            | CREATE INDEX idx_tb1_16952_990020 ON tb1_20191201_990020 USING btree (c1)
 public     | tb1_20191201_990020 | pk_idx_tb1_16952_990020                         |            | CREATE UNIQUE INDEX pk_idx_tb1_16952_990020 ON tb1_20191201_990020 USING btree (c1)
(30 rows)


\c - - - :worker_2_port
select * from pg_indexes where schemaname='public' and tablename like 'tb1%' order by tablename, indexname;
 schemaname |      tablename      |                    indexname                    | tablespace |                                               indexdef                                               
------------+---------------------+-------------------------------------------------+------------+------------------------------------------------------------------------------------------------------
 public     | tb1_20190301_990003 | idx_tb1234567890123456789012345678_16916_990003 |            | CREATE INDEX idx_tb1234567890123456789012345678_16916_990003 ON tb1_20190301_990003 USING btree (c1)
 public     | tb1_20190301_990003 | idx_tb1_16916_990003                            |            | CREATE INDEX idx_tb1_16916_990003 ON tb1_20190301_990003 USING btree (c1)
 public     | tb1_20190301_990003 | pk_idx_tb1_16916_990003                         |            | CREATE UNIQUE INDEX pk_idx_tb1_16916_990003 ON tb1_20190301_990003 USING btree (c1)
 public     | tb1_20190401_990005 | idx_tb1234567890123456789012345678_16920_990005 |            | CREATE INDEX idx_tb1234567890123456789012345678_16920_990005 ON tb1_20190401_990005 USING btree (c1)
 public     | tb1_20190401_990005 | idx_tb1_16920_990005                            |            | CREATE INDEX idx_tb1_16920_990005 ON tb1_20190401_990005 USING btree (c1)
 public     | tb1_20190401_990005 | pk_idx_tb1_16920_990005                         |            | CREATE UNIQUE INDEX pk_idx_tb1_16920_990005 ON tb1_20190401_990005 USING btree (c1)
 public     | tb1_20190501_990007 | idx_tb1234567890123456789012345678_16924_990007 |            | CREATE INDEX idx_tb1234567890123456789012345678_16924_990007 ON tb1_20190501_990007 USING btree (c1)
 public     | tb1_20190501_990007 | idx_tb1_16924_990007                            |            | CREATE INDEX idx_tb1_16924_990007 ON tb1_20190501_990007 USING btree (c1)
 public     | tb1_20190501_990007 | pk_idx_tb1_16924_990007                         |            | CREATE UNIQUE INDEX pk_idx_tb1_16924_990007 ON tb1_20190501_990007 USING btree (c1)
 public     | tb1_20190601_990009 | idx_tb1234567890123456789012345678_16928_990009 |            | CREATE INDEX idx_tb1234567890123456789012345678_16928_990009 ON tb1_20190601_990009 USING btree (c1)
 public     | tb1_20190601_990009 | idx_tb1_16928_990009                            |            | CREATE INDEX idx_tb1_16928_990009 ON tb1_20190601_990009 USING btree (c1)
 public     | tb1_20190601_990009 | pk_idx_tb1_16928_990009                         |            | CREATE UNIQUE INDEX pk_idx_tb1_16928_990009 ON tb1_20190601_990009 USING btree (c1)
 public     | tb1_20190701_990011 | idx_tb1234567890123456789012345678_16932_990011 |            | CREATE INDEX idx_tb1234567890123456789012345678_16932_990011 ON tb1_20190701_990011 USING btree (c1)
 public     | tb1_20190701_990011 | idx_tb1_16932_990011                            |            | CREATE INDEX idx_tb1_16932_990011 ON tb1_20190701_990011 USING btree (c1)
 public     | tb1_20190701_990011 | pk_idx_tb1_16932_990011                         |            | CREATE UNIQUE INDEX pk_idx_tb1_16932_990011 ON tb1_20190701_990011 USING btree (c1)
 public     | tb1_20190801_990013 | idx_tb1234567890123456789012345678_16936_990013 |            | CREATE INDEX idx_tb1234567890123456789012345678_16936_990013 ON tb1_20190801_990013 USING btree (c1)
 public     | tb1_20190801_990013 | idx_tb1_16936_990013                            |            | CREATE INDEX idx_tb1_16936_990013 ON tb1_20190801_990013 USING btree (c1)
 public     | tb1_20190801_990013 | pk_idx_tb1_16936_990013                         |            | CREATE UNIQUE INDEX pk_idx_tb1_16936_990013 ON tb1_20190801_990013 USING btree (c1)
 public     | tb1_20190901_990015 | idx_tb1234567890123456789012345678_16940_990015 |            | CREATE INDEX idx_tb1234567890123456789012345678_16940_990015 ON tb1_20190901_990015 USING btree (c1)
 public     | tb1_20190901_990015 | idx_tb1_16940_990015                            |            | CREATE INDEX idx_tb1_16940_990015 ON tb1_20190901_990015 USING btree (c1)
 public     | tb1_20190901_990015 | pk_idx_tb1_16940_990015                         |            | CREATE UNIQUE INDEX pk_idx_tb1_16940_990015 ON tb1_20190901_990015 USING btree (c1)
 public     | tb1_20191001_990017 | idx_tb1234567890123456789012345678_16944_990017 |            | CREATE INDEX idx_tb1234567890123456789012345678_16944_990017 ON tb1_20191001_990017 USING btree (c1)
 public     | tb1_20191001_990017 | idx_tb1_16944_990017                            |            | CREATE INDEX idx_tb1_16944_990017 ON tb1_20191001_990017 USING btree (c1)
 public     | tb1_20191001_990017 | pk_idx_tb1_16944_990017                         |            | CREATE UNIQUE INDEX pk_idx_tb1_16944_990017 ON tb1_20191001_990017 USING btree (c1)
 public     | tb1_20191101_990019 | idx_tb1234567890123456789012345678_16948_990019 |            | CREATE INDEX idx_tb1234567890123456789012345678_16948_990019 ON tb1_20191101_990019 USING btree (c1)
 public     | tb1_20191101_990019 | idx_tb1_16948_990019                            |            | CREATE INDEX idx_tb1_16948_990019 ON tb1_20191101_990019 USING btree (c1)
 public     | tb1_20191101_990019 | pk_idx_tb1_16948_990019                         |            | CREATE UNIQUE INDEX pk_idx_tb1_16948_990019 ON tb1_20191101_990019 USING btree (c1)
 public     | tb1_20191201_990021 | idx_tb1234567890123456789012345678_16952_990021 |            | CREATE INDEX idx_tb1234567890123456789012345678_16952_990021 ON tb1_20191201_990021 USING btree (c1)
 public     | tb1_20191201_990021 | idx_tb1_16952_990021                            |            | CREATE INDEX idx_tb1_16952_990021 ON tb1_20191201_990021 USING btree (c1)
 public     | tb1_20191201_990021 | pk_idx_tb1_16952_990021                         |            | CREATE UNIQUE INDEX pk_idx_tb1_16952_990021 ON tb1_20191201_990021 USING btree (c1)
(30 rows)


\c - - - :master_port

-- 新增分区补建索引
select rds.add_range_partitions('public.tb1', '2020-01-01'::date, '1 month', 3);
ERROR:  type "create_idx_on_parted_table" does not exist
LINE 1: SELECT create_idx_on_parted_table 'alter table ' || l_part_n...
               ^
QUERY:  SELECT create_idx_on_parted_table 'alter table ' || l_part_name || ' add constraint ' || l_idx_name || ' primary key using index ' || l_idx_name
CONTEXT:  PL/pgSQL function rds.func_ddl_command_end() line 63 at assignment
SQL statement "create table tb1_20200101 partition of tb1 for values from ('20200101') to ('20200201')"
PL/pgSQL function rds.add_range_partitions(regclass,date,character varying,integer) line 38 at EXECUTE

-- 验证分区
select relname, relnamespace::regnamespace::text, pg_get_expr(relpartbound, oid, true) vals
  from pg_class
 where relnamespace::regnamespace::text='public' and relname like 'tb1%' and relispartition=true
 order by relname;
   relname    | relnamespace |                       vals                       
--------------+--------------+--------------------------------------------------
 tb1_20190301 | public       | FOR VALUES FROM ('03-01-2019') TO ('04-01-2019')
 tb1_20190401 | public       | FOR VALUES FROM ('04-01-2019') TO ('05-01-2019')
 tb1_20190501 | public       | FOR VALUES FROM ('05-01-2019') TO ('06-01-2019')
 tb1_20190601 | public       | FOR VALUES FROM ('06-01-2019') TO ('07-01-2019')
 tb1_20190701 | public       | FOR VALUES FROM ('07-01-2019') TO ('08-01-2019')
 tb1_20190801 | public       | FOR VALUES FROM ('08-01-2019') TO ('09-01-2019')
 tb1_20190901 | public       | FOR VALUES FROM ('09-01-2019') TO ('10-01-2019')
 tb1_20191001 | public       | FOR VALUES FROM ('10-01-2019') TO ('11-01-2019')
 tb1_20191101 | public       | FOR VALUES FROM ('11-01-2019') TO ('12-01-2019')
 tb1_20191201 | public       | FOR VALUES FROM ('12-01-2019') TO ('01-01-2020')
(10 rows)


\c - - - :worker_1_port
select relname, relnamespace::regnamespace::text, pg_get_expr(relpartbound, oid, true) vals
  from pg_class
 where relnamespace::regnamespace::text='public' and relname like 'tb1%' and relispartition=true
 order by relname;
       relname       | relnamespace |                       vals                       
---------------------+--------------+--------------------------------------------------
 tb1_20190301_990002 | public       | FOR VALUES FROM ('03-01-2019') TO ('04-01-2019')
 tb1_20190401_990004 | public       | FOR VALUES FROM ('04-01-2019') TO ('05-01-2019')
 tb1_20190501_990006 | public       | FOR VALUES FROM ('05-01-2019') TO ('06-01-2019')
 tb1_20190601_990008 | public       | FOR VALUES FROM ('06-01-2019') TO ('07-01-2019')
 tb1_20190701_990010 | public       | FOR VALUES FROM ('07-01-2019') TO ('08-01-2019')
 tb1_20190801_990012 | public       | FOR VALUES FROM ('08-01-2019') TO ('09-01-2019')
 tb1_20190901_990014 | public       | FOR VALUES FROM ('09-01-2019') TO ('10-01-2019')
 tb1_20191001_990016 | public       | FOR VALUES FROM ('10-01-2019') TO ('11-01-2019')
 tb1_20191101_990018 | public       | FOR VALUES FROM ('11-01-2019') TO ('12-01-2019')
 tb1_20191201_990020 | public       | FOR VALUES FROM ('12-01-2019') TO ('01-01-2020')
(10 rows)


\c - - - :worker_2_port
select relname, relnamespace::regnamespace::text, pg_get_expr(relpartbound, oid, true) vals
  from pg_class
 where relnamespace::regnamespace::text='public' and relname like 'tb1%' and relispartition=true
 order by relname;
       relname       | relnamespace |                       vals                       
---------------------+--------------+--------------------------------------------------
 tb1_20190301_990003 | public       | FOR VALUES FROM ('03-01-2019') TO ('04-01-2019')
 tb1_20190401_990005 | public       | FOR VALUES FROM ('04-01-2019') TO ('05-01-2019')
 tb1_20190501_990007 | public       | FOR VALUES FROM ('05-01-2019') TO ('06-01-2019')
 tb1_20190601_990009 | public       | FOR VALUES FROM ('06-01-2019') TO ('07-01-2019')
 tb1_20190701_990011 | public       | FOR VALUES FROM ('07-01-2019') TO ('08-01-2019')
 tb1_20190801_990013 | public       | FOR VALUES FROM ('08-01-2019') TO ('09-01-2019')
 tb1_20190901_990015 | public       | FOR VALUES FROM ('09-01-2019') TO ('10-01-2019')
 tb1_20191001_990017 | public       | FOR VALUES FROM ('10-01-2019') TO ('11-01-2019')
 tb1_20191101_990019 | public       | FOR VALUES FROM ('11-01-2019') TO ('12-01-2019')
 tb1_20191201_990021 | public       | FOR VALUES FROM ('12-01-2019') TO ('01-01-2020')
(10 rows)


\c - - - :master_port

-- 验证索引
select * from pg_indexes where schemaname='public' and tablename like 'tb1%' order by tablename, indexname;
 schemaname |  tablename   |                indexname                 | tablespace |                                        indexdef                                        
------------+--------------+------------------------------------------+------------+----------------------------------------------------------------------------------------
 public     | tb1_20190301 | idx_tb1234567890123456789012345678_16916 |            | CREATE INDEX idx_tb1234567890123456789012345678_16916 ON tb1_20190301 USING btree (c1)
 public     | tb1_20190301 | idx_tb1_16916                            |            | CREATE INDEX idx_tb1_16916 ON tb1_20190301 USING btree (c1)
 public     | tb1_20190301 | pk_idx_tb1_16916                         |            | CREATE UNIQUE INDEX pk_idx_tb1_16916 ON tb1_20190301 USING btree (c1)
 public     | tb1_20190401 | idx_tb1234567890123456789012345678_16920 |            | CREATE INDEX idx_tb1234567890123456789012345678_16920 ON tb1_20190401 USING btree (c1)
 public     | tb1_20190401 | idx_tb1_16920                            |            | CREATE INDEX idx_tb1_16920 ON tb1_20190401 USING btree (c1)
 public     | tb1_20190401 | pk_idx_tb1_16920                         |            | CREATE UNIQUE INDEX pk_idx_tb1_16920 ON tb1_20190401 USING btree (c1)
 public     | tb1_20190501 | idx_tb1234567890123456789012345678_16924 |            | CREATE INDEX idx_tb1234567890123456789012345678_16924 ON tb1_20190501 USING btree (c1)
 public     | tb1_20190501 | idx_tb1_16924                            |            | CREATE INDEX idx_tb1_16924 ON tb1_20190501 USING btree (c1)
 public     | tb1_20190501 | pk_idx_tb1_16924                         |            | CREATE UNIQUE INDEX pk_idx_tb1_16924 ON tb1_20190501 USING btree (c1)
 public     | tb1_20190601 | idx_tb1234567890123456789012345678_16928 |            | CREATE INDEX idx_tb1234567890123456789012345678_16928 ON tb1_20190601 USING btree (c1)
 public     | tb1_20190601 | idx_tb1_16928                            |            | CREATE INDEX idx_tb1_16928 ON tb1_20190601 USING btree (c1)
 public     | tb1_20190601 | pk_idx_tb1_16928                         |            | CREATE UNIQUE INDEX pk_idx_tb1_16928 ON tb1_20190601 USING btree (c1)
 public     | tb1_20190701 | idx_tb1234567890123456789012345678_16932 |            | CREATE INDEX idx_tb1234567890123456789012345678_16932 ON tb1_20190701 USING btree (c1)
 public     | tb1_20190701 | idx_tb1_16932                            |            | CREATE INDEX idx_tb1_16932 ON tb1_20190701 USING btree (c1)
 public     | tb1_20190701 | pk_idx_tb1_16932                         |            | CREATE UNIQUE INDEX pk_idx_tb1_16932 ON tb1_20190701 USING btree (c1)
 public     | tb1_20190801 | idx_tb1234567890123456789012345678_16936 |            | CREATE INDEX idx_tb1234567890123456789012345678_16936 ON tb1_20190801 USING btree (c1)
 public     | tb1_20190801 | idx_tb1_16936                            |            | CREATE INDEX idx_tb1_16936 ON tb1_20190801 USING btree (c1)
 public     | tb1_20190801 | pk_idx_tb1_16936                         |            | CREATE UNIQUE INDEX pk_idx_tb1_16936 ON tb1_20190801 USING btree (c1)
 public     | tb1_20190901 | idx_tb1234567890123456789012345678_16940 |            | CREATE INDEX idx_tb1234567890123456789012345678_16940 ON tb1_20190901 USING btree (c1)
 public     | tb1_20190901 | idx_tb1_16940                            |            | CREATE INDEX idx_tb1_16940 ON tb1_20190901 USING btree (c1)
 public     | tb1_20190901 | pk_idx_tb1_16940                         |            | CREATE UNIQUE INDEX pk_idx_tb1_16940 ON tb1_20190901 USING btree (c1)
 public     | tb1_20191001 | idx_tb1234567890123456789012345678_16944 |            | CREATE INDEX idx_tb1234567890123456789012345678_16944 ON tb1_20191001 USING btree (c1)
 public     | tb1_20191001 | idx_tb1_16944                            |            | CREATE INDEX idx_tb1_16944 ON tb1_20191001 USING btree (c1)
 public     | tb1_20191001 | pk_idx_tb1_16944                         |            | CREATE UNIQUE INDEX pk_idx_tb1_16944 ON tb1_20191001 USING btree (c1)
 public     | tb1_20191101 | idx_tb1234567890123456789012345678_16948 |            | CREATE INDEX idx_tb1234567890123456789012345678_16948 ON tb1_20191101 USING btree (c1)
 public     | tb1_20191101 | idx_tb1_16948                            |            | CREATE INDEX idx_tb1_16948 ON tb1_20191101 USING btree (c1)
 public     | tb1_20191101 | pk_idx_tb1_16948                         |            | CREATE UNIQUE INDEX pk_idx_tb1_16948 ON tb1_20191101 USING btree (c1)
 public     | tb1_20191201 | idx_tb1234567890123456789012345678_16952 |            | CREATE INDEX idx_tb1234567890123456789012345678_16952 ON tb1_20191201 USING btree (c1)
 public     | tb1_20191201 | idx_tb1_16952                            |            | CREATE INDEX idx_tb1_16952 ON tb1_20191201 USING btree (c1)
 public     | tb1_20191201 | pk_idx_tb1_16952                         |            | CREATE UNIQUE INDEX pk_idx_tb1_16952 ON tb1_20191201 USING btree (c1)
(30 rows)

select * from rds.user_tab_part_indexes_def;
 tab_name |              idx_name              |             idx_sql              | is_pkey 
----------+------------------------------------+----------------------------------+---------
 tb1      | idx_tb1                            | create index    %i on   %t(c1)   | f
 tb1      | idx_tb1234567890123456789012345678 | create index %i on %t(c1)        | f
 tb1      | pk_idx_tb1                         | create unique index %i on %t(c1) | t
(3 rows)


\c - - - :worker_1_port
select * from pg_indexes where schemaname='public' and tablename like 'tb1%' order by tablename, indexname;
 schemaname |      tablename      |                    indexname                    | tablespace |                                               indexdef                                               
------------+---------------------+-------------------------------------------------+------------+------------------------------------------------------------------------------------------------------
 public     | tb1_20190301_990002 | idx_tb1234567890123456789012345678_16916_990002 |            | CREATE INDEX idx_tb1234567890123456789012345678_16916_990002 ON tb1_20190301_990002 USING btree (c1)
 public     | tb1_20190301_990002 | idx_tb1_16916_990002                            |            | CREATE INDEX idx_tb1_16916_990002 ON tb1_20190301_990002 USING btree (c1)
 public     | tb1_20190301_990002 | pk_idx_tb1_16916_990002                         |            | CREATE UNIQUE INDEX pk_idx_tb1_16916_990002 ON tb1_20190301_990002 USING btree (c1)
 public     | tb1_20190401_990004 | idx_tb1234567890123456789012345678_16920_990004 |            | CREATE INDEX idx_tb1234567890123456789012345678_16920_990004 ON tb1_20190401_990004 USING btree (c1)
 public     | tb1_20190401_990004 | idx_tb1_16920_990004                            |            | CREATE INDEX idx_tb1_16920_990004 ON tb1_20190401_990004 USING btree (c1)
 public     | tb1_20190401_990004 | pk_idx_tb1_16920_990004                         |            | CREATE UNIQUE INDEX pk_idx_tb1_16920_990004 ON tb1_20190401_990004 USING btree (c1)
 public     | tb1_20190501_990006 | idx_tb1234567890123456789012345678_16924_990006 |            | CREATE INDEX idx_tb1234567890123456789012345678_16924_990006 ON tb1_20190501_990006 USING btree (c1)
 public     | tb1_20190501_990006 | idx_tb1_16924_990006                            |            | CREATE INDEX idx_tb1_16924_990006 ON tb1_20190501_990006 USING btree (c1)
 public     | tb1_20190501_990006 | pk_idx_tb1_16924_990006                         |            | CREATE UNIQUE INDEX pk_idx_tb1_16924_990006 ON tb1_20190501_990006 USING btree (c1)
 public     | tb1_20190601_990008 | idx_tb1234567890123456789012345678_16928_990008 |            | CREATE INDEX idx_tb1234567890123456789012345678_16928_990008 ON tb1_20190601_990008 USING btree (c1)
 public     | tb1_20190601_990008 | idx_tb1_16928_990008                            |            | CREATE INDEX idx_tb1_16928_990008 ON tb1_20190601_990008 USING btree (c1)
 public     | tb1_20190601_990008 | pk_idx_tb1_16928_990008                         |            | CREATE UNIQUE INDEX pk_idx_tb1_16928_990008 ON tb1_20190601_990008 USING btree (c1)
 public     | tb1_20190701_990010 | idx_tb1234567890123456789012345678_16932_990010 |            | CREATE INDEX idx_tb1234567890123456789012345678_16932_990010 ON tb1_20190701_990010 USING btree (c1)
 public     | tb1_20190701_990010 | idx_tb1_16932_990010                            |            | CREATE INDEX idx_tb1_16932_990010 ON tb1_20190701_990010 USING btree (c1)
 public     | tb1_20190701_990010 | pk_idx_tb1_16932_990010                         |            | CREATE UNIQUE INDEX pk_idx_tb1_16932_990010 ON tb1_20190701_990010 USING btree (c1)
 public     | tb1_20190801_990012 | idx_tb1234567890123456789012345678_16936_990012 |            | CREATE INDEX idx_tb1234567890123456789012345678_16936_990012 ON tb1_20190801_990012 USING btree (c1)
 public     | tb1_20190801_990012 | idx_tb1_16936_990012                            |            | CREATE INDEX idx_tb1_16936_990012 ON tb1_20190801_990012 USING btree (c1)
 public     | tb1_20190801_990012 | pk_idx_tb1_16936_990012                         |            | CREATE UNIQUE INDEX pk_idx_tb1_16936_990012 ON tb1_20190801_990012 USING btree (c1)
 public     | tb1_20190901_990014 | idx_tb1234567890123456789012345678_16940_990014 |            | CREATE INDEX idx_tb1234567890123456789012345678_16940_990014 ON tb1_20190901_990014 USING btree (c1)
 public     | tb1_20190901_990014 | idx_tb1_16940_990014                            |            | CREATE INDEX idx_tb1_16940_990014 ON tb1_20190901_990014 USING btree (c1)
 public     | tb1_20190901_990014 | pk_idx_tb1_16940_990014                         |            | CREATE UNIQUE INDEX pk_idx_tb1_16940_990014 ON tb1_20190901_990014 USING btree (c1)
 public     | tb1_20191001_990016 | idx_tb1234567890123456789012345678_16944_990016 |            | CREATE INDEX idx_tb1234567890123456789012345678_16944_990016 ON tb1_20191001_990016 USING btree (c1)
 public     | tb1_20191001_990016 | idx_tb1_16944_990016                            |            | CREATE INDEX idx_tb1_16944_990016 ON tb1_20191001_990016 USING btree (c1)
 public     | tb1_20191001_990016 | pk_idx_tb1_16944_990016                         |            | CREATE UNIQUE INDEX pk_idx_tb1_16944_990016 ON tb1_20191001_990016 USING btree (c1)
 public     | tb1_20191101_990018 | idx_tb1234567890123456789012345678_16948_990018 |            | CREATE INDEX idx_tb1234567890123456789012345678_16948_990018 ON tb1_20191101_990018 USING btree (c1)
 public     | tb1_20191101_990018 | idx_tb1_16948_990018                            |            | CREATE INDEX idx_tb1_16948_990018 ON tb1_20191101_990018 USING btree (c1)
 public     | tb1_20191101_990018 | pk_idx_tb1_16948_990018                         |            | CREATE UNIQUE INDEX pk_idx_tb1_16948_990018 ON tb1_20191101_990018 USING btree (c1)
 public     | tb1_20191201_990020 | idx_tb1234567890123456789012345678_16952_990020 |            | CREATE INDEX idx_tb1234567890123456789012345678_16952_990020 ON tb1_20191201_990020 USING btree (c1)
 public     | tb1_20191201_990020 | idx_tb1_16952_990020                            |            | CREATE INDEX idx_tb1_16952_990020 ON tb1_20191201_990020 USING btree (c1)
 public     | tb1_20191201_990020 | pk_idx_tb1_16952_990020                         |            | CREATE UNIQUE INDEX pk_idx_tb1_16952_990020 ON tb1_20191201_990020 USING btree (c1)
(30 rows)


\c - - - :worker_2_port
select * from pg_indexes where schemaname='public' and tablename like 'tb1%' order by tablename, indexname;
 schemaname |      tablename      |                    indexname                    | tablespace |                                               indexdef                                               
------------+---------------------+-------------------------------------------------+------------+------------------------------------------------------------------------------------------------------
 public     | tb1_20190301_990003 | idx_tb1234567890123456789012345678_16916_990003 |            | CREATE INDEX idx_tb1234567890123456789012345678_16916_990003 ON tb1_20190301_990003 USING btree (c1)
 public     | tb1_20190301_990003 | idx_tb1_16916_990003                            |            | CREATE INDEX idx_tb1_16916_990003 ON tb1_20190301_990003 USING btree (c1)
 public     | tb1_20190301_990003 | pk_idx_tb1_16916_990003                         |            | CREATE UNIQUE INDEX pk_idx_tb1_16916_990003 ON tb1_20190301_990003 USING btree (c1)
 public     | tb1_20190401_990005 | idx_tb1234567890123456789012345678_16920_990005 |            | CREATE INDEX idx_tb1234567890123456789012345678_16920_990005 ON tb1_20190401_990005 USING btree (c1)
 public     | tb1_20190401_990005 | idx_tb1_16920_990005                            |            | CREATE INDEX idx_tb1_16920_990005 ON tb1_20190401_990005 USING btree (c1)
 public     | tb1_20190401_990005 | pk_idx_tb1_16920_990005                         |            | CREATE UNIQUE INDEX pk_idx_tb1_16920_990005 ON tb1_20190401_990005 USING btree (c1)
 public     | tb1_20190501_990007 | idx_tb1234567890123456789012345678_16924_990007 |            | CREATE INDEX idx_tb1234567890123456789012345678_16924_990007 ON tb1_20190501_990007 USING btree (c1)
 public     | tb1_20190501_990007 | idx_tb1_16924_990007                            |            | CREATE INDEX idx_tb1_16924_990007 ON tb1_20190501_990007 USING btree (c1)
 public     | tb1_20190501_990007 | pk_idx_tb1_16924_990007                         |            | CREATE UNIQUE INDEX pk_idx_tb1_16924_990007 ON tb1_20190501_990007 USING btree (c1)
 public     | tb1_20190601_990009 | idx_tb1234567890123456789012345678_16928_990009 |            | CREATE INDEX idx_tb1234567890123456789012345678_16928_990009 ON tb1_20190601_990009 USING btree (c1)
 public     | tb1_20190601_990009 | idx_tb1_16928_990009                            |            | CREATE INDEX idx_tb1_16928_990009 ON tb1_20190601_990009 USING btree (c1)
 public     | tb1_20190601_990009 | pk_idx_tb1_16928_990009                         |            | CREATE UNIQUE INDEX pk_idx_tb1_16928_990009 ON tb1_20190601_990009 USING btree (c1)
 public     | tb1_20190701_990011 | idx_tb1234567890123456789012345678_16932_990011 |            | CREATE INDEX idx_tb1234567890123456789012345678_16932_990011 ON tb1_20190701_990011 USING btree (c1)
 public     | tb1_20190701_990011 | idx_tb1_16932_990011                            |            | CREATE INDEX idx_tb1_16932_990011 ON tb1_20190701_990011 USING btree (c1)
 public     | tb1_20190701_990011 | pk_idx_tb1_16932_990011                         |            | CREATE UNIQUE INDEX pk_idx_tb1_16932_990011 ON tb1_20190701_990011 USING btree (c1)
 public     | tb1_20190801_990013 | idx_tb1234567890123456789012345678_16936_990013 |            | CREATE INDEX idx_tb1234567890123456789012345678_16936_990013 ON tb1_20190801_990013 USING btree (c1)
 public     | tb1_20190801_990013 | idx_tb1_16936_990013                            |            | CREATE INDEX idx_tb1_16936_990013 ON tb1_20190801_990013 USING btree (c1)
 public     | tb1_20190801_990013 | pk_idx_tb1_16936_990013                         |            | CREATE UNIQUE INDEX pk_idx_tb1_16936_990013 ON tb1_20190801_990013 USING btree (c1)
 public     | tb1_20190901_990015 | idx_tb1234567890123456789012345678_16940_990015 |            | CREATE INDEX idx_tb1234567890123456789012345678_16940_990015 ON tb1_20190901_990015 USING btree (c1)
 public     | tb1_20190901_990015 | idx_tb1_16940_990015                            |            | CREATE INDEX idx_tb1_16940_990015 ON tb1_20190901_990015 USING btree (c1)
 public     | tb1_20190901_990015 | pk_idx_tb1_16940_990015                         |            | CREATE UNIQUE INDEX pk_idx_tb1_16940_990015 ON tb1_20190901_990015 USING btree (c1)
 public     | tb1_20191001_990017 | idx_tb1234567890123456789012345678_16944_990017 |            | CREATE INDEX idx_tb1234567890123456789012345678_16944_990017 ON tb1_20191001_990017 USING btree (c1)
 public     | tb1_20191001_990017 | idx_tb1_16944_990017                            |            | CREATE INDEX idx_tb1_16944_990017 ON tb1_20191001_990017 USING btree (c1)
 public     | tb1_20191001_990017 | pk_idx_tb1_16944_990017                         |            | CREATE UNIQUE INDEX pk_idx_tb1_16944_990017 ON tb1_20191001_990017 USING btree (c1)
 public     | tb1_20191101_990019 | idx_tb1234567890123456789012345678_16948_990019 |            | CREATE INDEX idx_tb1234567890123456789012345678_16948_990019 ON tb1_20191101_990019 USING btree (c1)
 public     | tb1_20191101_990019 | idx_tb1_16948_990019                            |            | CREATE INDEX idx_tb1_16948_990019 ON tb1_20191101_990019 USING btree (c1)
 public     | tb1_20191101_990019 | pk_idx_tb1_16948_990019                         |            | CREATE UNIQUE INDEX pk_idx_tb1_16948_990019 ON tb1_20191101_990019 USING btree (c1)
 public     | tb1_20191201_990021 | idx_tb1234567890123456789012345678_16952_990021 |            | CREATE INDEX idx_tb1234567890123456789012345678_16952_990021 ON tb1_20191201_990021 USING btree (c1)
 public     | tb1_20191201_990021 | idx_tb1_16952_990021                            |            | CREATE INDEX idx_tb1_16952_990021 ON tb1_20191201_990021 USING btree (c1)
 public     | tb1_20191201_990021 | pk_idx_tb1_16952_990021                         |            | CREATE UNIQUE INDEX pk_idx_tb1_16952_990021 ON tb1_20191201_990021 USING btree (c1)
(30 rows)


\c - - - :master_port

-- 分区单独删除索引
drop index idx_tb1_16849;
ERROR:  index "idx_tb1_16849" does not exist

-- 验证索引
select * from pg_indexes where schemaname='public' and tablename like 'tb1%' order by tablename, indexname;
 schemaname |  tablename   |                indexname                 | tablespace |                                        indexdef                                        
------------+--------------+------------------------------------------+------------+----------------------------------------------------------------------------------------
 public     | tb1_20190301 | idx_tb1234567890123456789012345678_16916 |            | CREATE INDEX idx_tb1234567890123456789012345678_16916 ON tb1_20190301 USING btree (c1)
 public     | tb1_20190301 | idx_tb1_16916                            |            | CREATE INDEX idx_tb1_16916 ON tb1_20190301 USING btree (c1)
 public     | tb1_20190301 | pk_idx_tb1_16916                         |            | CREATE UNIQUE INDEX pk_idx_tb1_16916 ON tb1_20190301 USING btree (c1)
 public     | tb1_20190401 | idx_tb1234567890123456789012345678_16920 |            | CREATE INDEX idx_tb1234567890123456789012345678_16920 ON tb1_20190401 USING btree (c1)
 public     | tb1_20190401 | idx_tb1_16920                            |            | CREATE INDEX idx_tb1_16920 ON tb1_20190401 USING btree (c1)
 public     | tb1_20190401 | pk_idx_tb1_16920                         |            | CREATE UNIQUE INDEX pk_idx_tb1_16920 ON tb1_20190401 USING btree (c1)
 public     | tb1_20190501 | idx_tb1234567890123456789012345678_16924 |            | CREATE INDEX idx_tb1234567890123456789012345678_16924 ON tb1_20190501 USING btree (c1)
 public     | tb1_20190501 | idx_tb1_16924                            |            | CREATE INDEX idx_tb1_16924 ON tb1_20190501 USING btree (c1)
 public     | tb1_20190501 | pk_idx_tb1_16924                         |            | CREATE UNIQUE INDEX pk_idx_tb1_16924 ON tb1_20190501 USING btree (c1)
 public     | tb1_20190601 | idx_tb1234567890123456789012345678_16928 |            | CREATE INDEX idx_tb1234567890123456789012345678_16928 ON tb1_20190601 USING btree (c1)
 public     | tb1_20190601 | idx_tb1_16928                            |            | CREATE INDEX idx_tb1_16928 ON tb1_20190601 USING btree (c1)
 public     | tb1_20190601 | pk_idx_tb1_16928                         |            | CREATE UNIQUE INDEX pk_idx_tb1_16928 ON tb1_20190601 USING btree (c1)
 public     | tb1_20190701 | idx_tb1234567890123456789012345678_16932 |            | CREATE INDEX idx_tb1234567890123456789012345678_16932 ON tb1_20190701 USING btree (c1)
 public     | tb1_20190701 | idx_tb1_16932                            |            | CREATE INDEX idx_tb1_16932 ON tb1_20190701 USING btree (c1)
 public     | tb1_20190701 | pk_idx_tb1_16932                         |            | CREATE UNIQUE INDEX pk_idx_tb1_16932 ON tb1_20190701 USING btree (c1)
 public     | tb1_20190801 | idx_tb1234567890123456789012345678_16936 |            | CREATE INDEX idx_tb1234567890123456789012345678_16936 ON tb1_20190801 USING btree (c1)
 public     | tb1_20190801 | idx_tb1_16936                            |            | CREATE INDEX idx_tb1_16936 ON tb1_20190801 USING btree (c1)
 public     | tb1_20190801 | pk_idx_tb1_16936                         |            | CREATE UNIQUE INDEX pk_idx_tb1_16936 ON tb1_20190801 USING btree (c1)
 public     | tb1_20190901 | idx_tb1234567890123456789012345678_16940 |            | CREATE INDEX idx_tb1234567890123456789012345678_16940 ON tb1_20190901 USING btree (c1)
 public     | tb1_20190901 | idx_tb1_16940                            |            | CREATE INDEX idx_tb1_16940 ON tb1_20190901 USING btree (c1)
 public     | tb1_20190901 | pk_idx_tb1_16940                         |            | CREATE UNIQUE INDEX pk_idx_tb1_16940 ON tb1_20190901 USING btree (c1)
 public     | tb1_20191001 | idx_tb1234567890123456789012345678_16944 |            | CREATE INDEX idx_tb1234567890123456789012345678_16944 ON tb1_20191001 USING btree (c1)
 public     | tb1_20191001 | idx_tb1_16944                            |            | CREATE INDEX idx_tb1_16944 ON tb1_20191001 USING btree (c1)
 public     | tb1_20191001 | pk_idx_tb1_16944                         |            | CREATE UNIQUE INDEX pk_idx_tb1_16944 ON tb1_20191001 USING btree (c1)
 public     | tb1_20191101 | idx_tb1234567890123456789012345678_16948 |            | CREATE INDEX idx_tb1234567890123456789012345678_16948 ON tb1_20191101 USING btree (c1)
 public     | tb1_20191101 | idx_tb1_16948                            |            | CREATE INDEX idx_tb1_16948 ON tb1_20191101 USING btree (c1)
 public     | tb1_20191101 | pk_idx_tb1_16948                         |            | CREATE UNIQUE INDEX pk_idx_tb1_16948 ON tb1_20191101 USING btree (c1)
 public     | tb1_20191201 | idx_tb1234567890123456789012345678_16952 |            | CREATE INDEX idx_tb1234567890123456789012345678_16952 ON tb1_20191201 USING btree (c1)
 public     | tb1_20191201 | idx_tb1_16952                            |            | CREATE INDEX idx_tb1_16952 ON tb1_20191201 USING btree (c1)
 public     | tb1_20191201 | pk_idx_tb1_16952                         |            | CREATE UNIQUE INDEX pk_idx_tb1_16952 ON tb1_20191201 USING btree (c1)
(30 rows)

select * from rds.user_tab_part_indexes_def;
 tab_name |              idx_name              |             idx_sql              | is_pkey 
----------+------------------------------------+----------------------------------+---------
 tb1      | idx_tb1                            | create index    %i on   %t(c1)   | f
 tb1      | idx_tb1234567890123456789012345678 | create index %i on %t(c1)        | f
 tb1      | pk_idx_tb1                         | create unique index %i on %t(c1) | t
(3 rows)


\c - - - :worker_1_port
select * from pg_indexes where schemaname='public' and tablename like 'tb1%' order by tablename, indexname;
 schemaname |      tablename      |                    indexname                    | tablespace |                                               indexdef                                               
------------+---------------------+-------------------------------------------------+------------+------------------------------------------------------------------------------------------------------
 public     | tb1_20190301_990002 | idx_tb1234567890123456789012345678_16916_990002 |            | CREATE INDEX idx_tb1234567890123456789012345678_16916_990002 ON tb1_20190301_990002 USING btree (c1)
 public     | tb1_20190301_990002 | idx_tb1_16916_990002                            |            | CREATE INDEX idx_tb1_16916_990002 ON tb1_20190301_990002 USING btree (c1)
 public     | tb1_20190301_990002 | pk_idx_tb1_16916_990002                         |            | CREATE UNIQUE INDEX pk_idx_tb1_16916_990002 ON tb1_20190301_990002 USING btree (c1)
 public     | tb1_20190401_990004 | idx_tb1234567890123456789012345678_16920_990004 |            | CREATE INDEX idx_tb1234567890123456789012345678_16920_990004 ON tb1_20190401_990004 USING btree (c1)
 public     | tb1_20190401_990004 | idx_tb1_16920_990004                            |            | CREATE INDEX idx_tb1_16920_990004 ON tb1_20190401_990004 USING btree (c1)
 public     | tb1_20190401_990004 | pk_idx_tb1_16920_990004                         |            | CREATE UNIQUE INDEX pk_idx_tb1_16920_990004 ON tb1_20190401_990004 USING btree (c1)
 public     | tb1_20190501_990006 | idx_tb1234567890123456789012345678_16924_990006 |            | CREATE INDEX idx_tb1234567890123456789012345678_16924_990006 ON tb1_20190501_990006 USING btree (c1)
 public     | tb1_20190501_990006 | idx_tb1_16924_990006                            |            | CREATE INDEX idx_tb1_16924_990006 ON tb1_20190501_990006 USING btree (c1)
 public     | tb1_20190501_990006 | pk_idx_tb1_16924_990006                         |            | CREATE UNIQUE INDEX pk_idx_tb1_16924_990006 ON tb1_20190501_990006 USING btree (c1)
 public     | tb1_20190601_990008 | idx_tb1234567890123456789012345678_16928_990008 |            | CREATE INDEX idx_tb1234567890123456789012345678_16928_990008 ON tb1_20190601_990008 USING btree (c1)
 public     | tb1_20190601_990008 | idx_tb1_16928_990008                            |            | CREATE INDEX idx_tb1_16928_990008 ON tb1_20190601_990008 USING btree (c1)
 public     | tb1_20190601_990008 | pk_idx_tb1_16928_990008                         |            | CREATE UNIQUE INDEX pk_idx_tb1_16928_990008 ON tb1_20190601_990008 USING btree (c1)
 public     | tb1_20190701_990010 | idx_tb1234567890123456789012345678_16932_990010 |            | CREATE INDEX idx_tb1234567890123456789012345678_16932_990010 ON tb1_20190701_990010 USING btree (c1)
 public     | tb1_20190701_990010 | idx_tb1_16932_990010                            |            | CREATE INDEX idx_tb1_16932_990010 ON tb1_20190701_990010 USING btree (c1)
 public     | tb1_20190701_990010 | pk_idx_tb1_16932_990010                         |            | CREATE UNIQUE INDEX pk_idx_tb1_16932_990010 ON tb1_20190701_990010 USING btree (c1)
 public     | tb1_20190801_990012 | idx_tb1234567890123456789012345678_16936_990012 |            | CREATE INDEX idx_tb1234567890123456789012345678_16936_990012 ON tb1_20190801_990012 USING btree (c1)
 public     | tb1_20190801_990012 | idx_tb1_16936_990012                            |            | CREATE INDEX idx_tb1_16936_990012 ON tb1_20190801_990012 USING btree (c1)
 public     | tb1_20190801_990012 | pk_idx_tb1_16936_990012                         |            | CREATE UNIQUE INDEX pk_idx_tb1_16936_990012 ON tb1_20190801_990012 USING btree (c1)
 public     | tb1_20190901_990014 | idx_tb1234567890123456789012345678_16940_990014 |            | CREATE INDEX idx_tb1234567890123456789012345678_16940_990014 ON tb1_20190901_990014 USING btree (c1)
 public     | tb1_20190901_990014 | idx_tb1_16940_990014                            |            | CREATE INDEX idx_tb1_16940_990014 ON tb1_20190901_990014 USING btree (c1)
 public     | tb1_20190901_990014 | pk_idx_tb1_16940_990014                         |            | CREATE UNIQUE INDEX pk_idx_tb1_16940_990014 ON tb1_20190901_990014 USING btree (c1)
 public     | tb1_20191001_990016 | idx_tb1234567890123456789012345678_16944_990016 |            | CREATE INDEX idx_tb1234567890123456789012345678_16944_990016 ON tb1_20191001_990016 USING btree (c1)
 public     | tb1_20191001_990016 | idx_tb1_16944_990016                            |            | CREATE INDEX idx_tb1_16944_990016 ON tb1_20191001_990016 USING btree (c1)
 public     | tb1_20191001_990016 | pk_idx_tb1_16944_990016                         |            | CREATE UNIQUE INDEX pk_idx_tb1_16944_990016 ON tb1_20191001_990016 USING btree (c1)
 public     | tb1_20191101_990018 | idx_tb1234567890123456789012345678_16948_990018 |            | CREATE INDEX idx_tb1234567890123456789012345678_16948_990018 ON tb1_20191101_990018 USING btree (c1)
 public     | tb1_20191101_990018 | idx_tb1_16948_990018                            |            | CREATE INDEX idx_tb1_16948_990018 ON tb1_20191101_990018 USING btree (c1)
 public     | tb1_20191101_990018 | pk_idx_tb1_16948_990018                         |            | CREATE UNIQUE INDEX pk_idx_tb1_16948_990018 ON tb1_20191101_990018 USING btree (c1)
 public     | tb1_20191201_990020 | idx_tb1234567890123456789012345678_16952_990020 |            | CREATE INDEX idx_tb1234567890123456789012345678_16952_990020 ON tb1_20191201_990020 USING btree (c1)
 public     | tb1_20191201_990020 | idx_tb1_16952_990020                            |            | CREATE INDEX idx_tb1_16952_990020 ON tb1_20191201_990020 USING btree (c1)
 public     | tb1_20191201_990020 | pk_idx_tb1_16952_990020                         |            | CREATE UNIQUE INDEX pk_idx_tb1_16952_990020 ON tb1_20191201_990020 USING btree (c1)
(30 rows)


\c - - - :worker_2_port
select * from pg_indexes where schemaname='public' and tablename like 'tb1%' order by tablename, indexname;
 schemaname |      tablename      |                    indexname                    | tablespace |                                               indexdef                                               
------------+---------------------+-------------------------------------------------+------------+------------------------------------------------------------------------------------------------------
 public     | tb1_20190301_990003 | idx_tb1234567890123456789012345678_16916_990003 |            | CREATE INDEX idx_tb1234567890123456789012345678_16916_990003 ON tb1_20190301_990003 USING btree (c1)
 public     | tb1_20190301_990003 | idx_tb1_16916_990003                            |            | CREATE INDEX idx_tb1_16916_990003 ON tb1_20190301_990003 USING btree (c1)
 public     | tb1_20190301_990003 | pk_idx_tb1_16916_990003                         |            | CREATE UNIQUE INDEX pk_idx_tb1_16916_990003 ON tb1_20190301_990003 USING btree (c1)
 public     | tb1_20190401_990005 | idx_tb1234567890123456789012345678_16920_990005 |            | CREATE INDEX idx_tb1234567890123456789012345678_16920_990005 ON tb1_20190401_990005 USING btree (c1)
 public     | tb1_20190401_990005 | idx_tb1_16920_990005                            |            | CREATE INDEX idx_tb1_16920_990005 ON tb1_20190401_990005 USING btree (c1)
 public     | tb1_20190401_990005 | pk_idx_tb1_16920_990005                         |            | CREATE UNIQUE INDEX pk_idx_tb1_16920_990005 ON tb1_20190401_990005 USING btree (c1)
 public     | tb1_20190501_990007 | idx_tb1234567890123456789012345678_16924_990007 |            | CREATE INDEX idx_tb1234567890123456789012345678_16924_990007 ON tb1_20190501_990007 USING btree (c1)
 public     | tb1_20190501_990007 | idx_tb1_16924_990007                            |            | CREATE INDEX idx_tb1_16924_990007 ON tb1_20190501_990007 USING btree (c1)
 public     | tb1_20190501_990007 | pk_idx_tb1_16924_990007                         |            | CREATE UNIQUE INDEX pk_idx_tb1_16924_990007 ON tb1_20190501_990007 USING btree (c1)
 public     | tb1_20190601_990009 | idx_tb1234567890123456789012345678_16928_990009 |            | CREATE INDEX idx_tb1234567890123456789012345678_16928_990009 ON tb1_20190601_990009 USING btree (c1)
 public     | tb1_20190601_990009 | idx_tb1_16928_990009                            |            | CREATE INDEX idx_tb1_16928_990009 ON tb1_20190601_990009 USING btree (c1)
 public     | tb1_20190601_990009 | pk_idx_tb1_16928_990009                         |            | CREATE UNIQUE INDEX pk_idx_tb1_16928_990009 ON tb1_20190601_990009 USING btree (c1)
 public     | tb1_20190701_990011 | idx_tb1234567890123456789012345678_16932_990011 |            | CREATE INDEX idx_tb1234567890123456789012345678_16932_990011 ON tb1_20190701_990011 USING btree (c1)
 public     | tb1_20190701_990011 | idx_tb1_16932_990011                            |            | CREATE INDEX idx_tb1_16932_990011 ON tb1_20190701_990011 USING btree (c1)
 public     | tb1_20190701_990011 | pk_idx_tb1_16932_990011                         |            | CREATE UNIQUE INDEX pk_idx_tb1_16932_990011 ON tb1_20190701_990011 USING btree (c1)
 public     | tb1_20190801_990013 | idx_tb1234567890123456789012345678_16936_990013 |            | CREATE INDEX idx_tb1234567890123456789012345678_16936_990013 ON tb1_20190801_990013 USING btree (c1)
 public     | tb1_20190801_990013 | idx_tb1_16936_990013                            |            | CREATE INDEX idx_tb1_16936_990013 ON tb1_20190801_990013 USING btree (c1)
 public     | tb1_20190801_990013 | pk_idx_tb1_16936_990013                         |            | CREATE UNIQUE INDEX pk_idx_tb1_16936_990013 ON tb1_20190801_990013 USING btree (c1)
 public     | tb1_20190901_990015 | idx_tb1234567890123456789012345678_16940_990015 |            | CREATE INDEX idx_tb1234567890123456789012345678_16940_990015 ON tb1_20190901_990015 USING btree (c1)
 public     | tb1_20190901_990015 | idx_tb1_16940_990015                            |            | CREATE INDEX idx_tb1_16940_990015 ON tb1_20190901_990015 USING btree (c1)
 public     | tb1_20190901_990015 | pk_idx_tb1_16940_990015                         |            | CREATE UNIQUE INDEX pk_idx_tb1_16940_990015 ON tb1_20190901_990015 USING btree (c1)
 public     | tb1_20191001_990017 | idx_tb1234567890123456789012345678_16944_990017 |            | CREATE INDEX idx_tb1234567890123456789012345678_16944_990017 ON tb1_20191001_990017 USING btree (c1)
 public     | tb1_20191001_990017 | idx_tb1_16944_990017                            |            | CREATE INDEX idx_tb1_16944_990017 ON tb1_20191001_990017 USING btree (c1)
 public     | tb1_20191001_990017 | pk_idx_tb1_16944_990017                         |            | CREATE UNIQUE INDEX pk_idx_tb1_16944_990017 ON tb1_20191001_990017 USING btree (c1)
 public     | tb1_20191101_990019 | idx_tb1234567890123456789012345678_16948_990019 |            | CREATE INDEX idx_tb1234567890123456789012345678_16948_990019 ON tb1_20191101_990019 USING btree (c1)
 public     | tb1_20191101_990019 | idx_tb1_16948_990019                            |            | CREATE INDEX idx_tb1_16948_990019 ON tb1_20191101_990019 USING btree (c1)
 public     | tb1_20191101_990019 | pk_idx_tb1_16948_990019                         |            | CREATE UNIQUE INDEX pk_idx_tb1_16948_990019 ON tb1_20191101_990019 USING btree (c1)
 public     | tb1_20191201_990021 | idx_tb1234567890123456789012345678_16952_990021 |            | CREATE INDEX idx_tb1234567890123456789012345678_16952_990021 ON tb1_20191201_990021 USING btree (c1)
 public     | tb1_20191201_990021 | idx_tb1_16952_990021                            |            | CREATE INDEX idx_tb1_16952_990021 ON tb1_20191201_990021 USING btree (c1)
 public     | tb1_20191201_990021 | pk_idx_tb1_16952_990021                         |            | CREATE UNIQUE INDEX pk_idx_tb1_16952_990021 ON tb1_20191201_990021 USING btree (c1)
(30 rows)


\c - - - :master_port

-- 分区表删除索引
select rds.drop_idx_on_parted_table('public.tb1', 'idx_tb1');
 drop_idx_on_parted_table 
--------------------------
 
(1 row)


-- 验证索引
select * from pg_indexes where schemaname='public' and tablename like 'tb1%' order by tablename, indexname;
 schemaname |  tablename   |                indexname                 | tablespace |                                        indexdef                                        
------------+--------------+------------------------------------------+------------+----------------------------------------------------------------------------------------
 public     | tb1_20190301 | idx_tb1234567890123456789012345678_16916 |            | CREATE INDEX idx_tb1234567890123456789012345678_16916 ON tb1_20190301 USING btree (c1)
 public     | tb1_20190301 | pk_idx_tb1_16916                         |            | CREATE UNIQUE INDEX pk_idx_tb1_16916 ON tb1_20190301 USING btree (c1)
 public     | tb1_20190401 | idx_tb1234567890123456789012345678_16920 |            | CREATE INDEX idx_tb1234567890123456789012345678_16920 ON tb1_20190401 USING btree (c1)
 public     | tb1_20190401 | pk_idx_tb1_16920                         |            | CREATE UNIQUE INDEX pk_idx_tb1_16920 ON tb1_20190401 USING btree (c1)
 public     | tb1_20190501 | idx_tb1234567890123456789012345678_16924 |            | CREATE INDEX idx_tb1234567890123456789012345678_16924 ON tb1_20190501 USING btree (c1)
 public     | tb1_20190501 | pk_idx_tb1_16924                         |            | CREATE UNIQUE INDEX pk_idx_tb1_16924 ON tb1_20190501 USING btree (c1)
 public     | tb1_20190601 | idx_tb1234567890123456789012345678_16928 |            | CREATE INDEX idx_tb1234567890123456789012345678_16928 ON tb1_20190601 USING btree (c1)
 public     | tb1_20190601 | pk_idx_tb1_16928                         |            | CREATE UNIQUE INDEX pk_idx_tb1_16928 ON tb1_20190601 USING btree (c1)
 public     | tb1_20190701 | idx_tb1234567890123456789012345678_16932 |            | CREATE INDEX idx_tb1234567890123456789012345678_16932 ON tb1_20190701 USING btree (c1)
 public     | tb1_20190701 | pk_idx_tb1_16932                         |            | CREATE UNIQUE INDEX pk_idx_tb1_16932 ON tb1_20190701 USING btree (c1)
 public     | tb1_20190801 | idx_tb1234567890123456789012345678_16936 |            | CREATE INDEX idx_tb1234567890123456789012345678_16936 ON tb1_20190801 USING btree (c1)
 public     | tb1_20190801 | pk_idx_tb1_16936                         |            | CREATE UNIQUE INDEX pk_idx_tb1_16936 ON tb1_20190801 USING btree (c1)
 public     | tb1_20190901 | idx_tb1234567890123456789012345678_16940 |            | CREATE INDEX idx_tb1234567890123456789012345678_16940 ON tb1_20190901 USING btree (c1)
 public     | tb1_20190901 | pk_idx_tb1_16940                         |            | CREATE UNIQUE INDEX pk_idx_tb1_16940 ON tb1_20190901 USING btree (c1)
 public     | tb1_20191001 | idx_tb1234567890123456789012345678_16944 |            | CREATE INDEX idx_tb1234567890123456789012345678_16944 ON tb1_20191001 USING btree (c1)
 public     | tb1_20191001 | pk_idx_tb1_16944                         |            | CREATE UNIQUE INDEX pk_idx_tb1_16944 ON tb1_20191001 USING btree (c1)
 public     | tb1_20191101 | idx_tb1234567890123456789012345678_16948 |            | CREATE INDEX idx_tb1234567890123456789012345678_16948 ON tb1_20191101 USING btree (c1)
 public     | tb1_20191101 | pk_idx_tb1_16948                         |            | CREATE UNIQUE INDEX pk_idx_tb1_16948 ON tb1_20191101 USING btree (c1)
 public     | tb1_20191201 | idx_tb1234567890123456789012345678_16952 |            | CREATE INDEX idx_tb1234567890123456789012345678_16952 ON tb1_20191201 USING btree (c1)
 public     | tb1_20191201 | pk_idx_tb1_16952                         |            | CREATE UNIQUE INDEX pk_idx_tb1_16952 ON tb1_20191201 USING btree (c1)
(20 rows)

select * from rds.user_tab_part_indexes_def;
 tab_name |              idx_name              |             idx_sql              | is_pkey 
----------+------------------------------------+----------------------------------+---------
 tb1      | idx_tb1234567890123456789012345678 | create index %i on %t(c1)        | f
 tb1      | pk_idx_tb1                         | create unique index %i on %t(c1) | t
(2 rows)


\c - - - :worker_1_port
select * from pg_indexes where schemaname='public' and tablename like 'tb1%' order by tablename, indexname;
 schemaname |      tablename      |                    indexname                    | tablespace |                                               indexdef                                               
------------+---------------------+-------------------------------------------------+------------+------------------------------------------------------------------------------------------------------
 public     | tb1_20190301_990002 | idx_tb1234567890123456789012345678_16916_990002 |            | CREATE INDEX idx_tb1234567890123456789012345678_16916_990002 ON tb1_20190301_990002 USING btree (c1)
 public     | tb1_20190301_990002 | pk_idx_tb1_16916_990002                         |            | CREATE UNIQUE INDEX pk_idx_tb1_16916_990002 ON tb1_20190301_990002 USING btree (c1)
 public     | tb1_20190401_990004 | idx_tb1234567890123456789012345678_16920_990004 |            | CREATE INDEX idx_tb1234567890123456789012345678_16920_990004 ON tb1_20190401_990004 USING btree (c1)
 public     | tb1_20190401_990004 | pk_idx_tb1_16920_990004                         |            | CREATE UNIQUE INDEX pk_idx_tb1_16920_990004 ON tb1_20190401_990004 USING btree (c1)
 public     | tb1_20190501_990006 | idx_tb1234567890123456789012345678_16924_990006 |            | CREATE INDEX idx_tb1234567890123456789012345678_16924_990006 ON tb1_20190501_990006 USING btree (c1)
 public     | tb1_20190501_990006 | pk_idx_tb1_16924_990006                         |            | CREATE UNIQUE INDEX pk_idx_tb1_16924_990006 ON tb1_20190501_990006 USING btree (c1)
 public     | tb1_20190601_990008 | idx_tb1234567890123456789012345678_16928_990008 |            | CREATE INDEX idx_tb1234567890123456789012345678_16928_990008 ON tb1_20190601_990008 USING btree (c1)
 public     | tb1_20190601_990008 | pk_idx_tb1_16928_990008                         |            | CREATE UNIQUE INDEX pk_idx_tb1_16928_990008 ON tb1_20190601_990008 USING btree (c1)
 public     | tb1_20190701_990010 | idx_tb1234567890123456789012345678_16932_990010 |            | CREATE INDEX idx_tb1234567890123456789012345678_16932_990010 ON tb1_20190701_990010 USING btree (c1)
 public     | tb1_20190701_990010 | pk_idx_tb1_16932_990010                         |            | CREATE UNIQUE INDEX pk_idx_tb1_16932_990010 ON tb1_20190701_990010 USING btree (c1)
 public     | tb1_20190801_990012 | idx_tb1234567890123456789012345678_16936_990012 |            | CREATE INDEX idx_tb1234567890123456789012345678_16936_990012 ON tb1_20190801_990012 USING btree (c1)
 public     | tb1_20190801_990012 | pk_idx_tb1_16936_990012                         |            | CREATE UNIQUE INDEX pk_idx_tb1_16936_990012 ON tb1_20190801_990012 USING btree (c1)
 public     | tb1_20190901_990014 | idx_tb1234567890123456789012345678_16940_990014 |            | CREATE INDEX idx_tb1234567890123456789012345678_16940_990014 ON tb1_20190901_990014 USING btree (c1)
 public     | tb1_20190901_990014 | pk_idx_tb1_16940_990014                         |            | CREATE UNIQUE INDEX pk_idx_tb1_16940_990014 ON tb1_20190901_990014 USING btree (c1)
 public     | tb1_20191001_990016 | idx_tb1234567890123456789012345678_16944_990016 |            | CREATE INDEX idx_tb1234567890123456789012345678_16944_990016 ON tb1_20191001_990016 USING btree (c1)
 public     | tb1_20191001_990016 | pk_idx_tb1_16944_990016                         |            | CREATE UNIQUE INDEX pk_idx_tb1_16944_990016 ON tb1_20191001_990016 USING btree (c1)
 public     | tb1_20191101_990018 | idx_tb1234567890123456789012345678_16948_990018 |            | CREATE INDEX idx_tb1234567890123456789012345678_16948_990018 ON tb1_20191101_990018 USING btree (c1)
 public     | tb1_20191101_990018 | pk_idx_tb1_16948_990018                         |            | CREATE UNIQUE INDEX pk_idx_tb1_16948_990018 ON tb1_20191101_990018 USING btree (c1)
 public     | tb1_20191201_990020 | idx_tb1234567890123456789012345678_16952_990020 |            | CREATE INDEX idx_tb1234567890123456789012345678_16952_990020 ON tb1_20191201_990020 USING btree (c1)
 public     | tb1_20191201_990020 | pk_idx_tb1_16952_990020                         |            | CREATE UNIQUE INDEX pk_idx_tb1_16952_990020 ON tb1_20191201_990020 USING btree (c1)
(20 rows)


\c - - - :worker_2_port
select * from pg_indexes where schemaname='public' and tablename like 'tb1%' order by tablename, indexname;
 schemaname |      tablename      |                    indexname                    | tablespace |                                               indexdef                                               
------------+---------------------+-------------------------------------------------+------------+------------------------------------------------------------------------------------------------------
 public     | tb1_20190301_990003 | idx_tb1234567890123456789012345678_16916_990003 |            | CREATE INDEX idx_tb1234567890123456789012345678_16916_990003 ON tb1_20190301_990003 USING btree (c1)
 public     | tb1_20190301_990003 | pk_idx_tb1_16916_990003                         |            | CREATE UNIQUE INDEX pk_idx_tb1_16916_990003 ON tb1_20190301_990003 USING btree (c1)
 public     | tb1_20190401_990005 | idx_tb1234567890123456789012345678_16920_990005 |            | CREATE INDEX idx_tb1234567890123456789012345678_16920_990005 ON tb1_20190401_990005 USING btree (c1)
 public     | tb1_20190401_990005 | pk_idx_tb1_16920_990005                         |            | CREATE UNIQUE INDEX pk_idx_tb1_16920_990005 ON tb1_20190401_990005 USING btree (c1)
 public     | tb1_20190501_990007 | idx_tb1234567890123456789012345678_16924_990007 |            | CREATE INDEX idx_tb1234567890123456789012345678_16924_990007 ON tb1_20190501_990007 USING btree (c1)
 public     | tb1_20190501_990007 | pk_idx_tb1_16924_990007                         |            | CREATE UNIQUE INDEX pk_idx_tb1_16924_990007 ON tb1_20190501_990007 USING btree (c1)
 public     | tb1_20190601_990009 | idx_tb1234567890123456789012345678_16928_990009 |            | CREATE INDEX idx_tb1234567890123456789012345678_16928_990009 ON tb1_20190601_990009 USING btree (c1)
 public     | tb1_20190601_990009 | pk_idx_tb1_16928_990009                         |            | CREATE UNIQUE INDEX pk_idx_tb1_16928_990009 ON tb1_20190601_990009 USING btree (c1)
 public     | tb1_20190701_990011 | idx_tb1234567890123456789012345678_16932_990011 |            | CREATE INDEX idx_tb1234567890123456789012345678_16932_990011 ON tb1_20190701_990011 USING btree (c1)
 public     | tb1_20190701_990011 | pk_idx_tb1_16932_990011                         |            | CREATE UNIQUE INDEX pk_idx_tb1_16932_990011 ON tb1_20190701_990011 USING btree (c1)
 public     | tb1_20190801_990013 | idx_tb1234567890123456789012345678_16936_990013 |            | CREATE INDEX idx_tb1234567890123456789012345678_16936_990013 ON tb1_20190801_990013 USING btree (c1)
 public     | tb1_20190801_990013 | pk_idx_tb1_16936_990013                         |            | CREATE UNIQUE INDEX pk_idx_tb1_16936_990013 ON tb1_20190801_990013 USING btree (c1)
 public     | tb1_20190901_990015 | idx_tb1234567890123456789012345678_16940_990015 |            | CREATE INDEX idx_tb1234567890123456789012345678_16940_990015 ON tb1_20190901_990015 USING btree (c1)
 public     | tb1_20190901_990015 | pk_idx_tb1_16940_990015                         |            | CREATE UNIQUE INDEX pk_idx_tb1_16940_990015 ON tb1_20190901_990015 USING btree (c1)
 public     | tb1_20191001_990017 | idx_tb1234567890123456789012345678_16944_990017 |            | CREATE INDEX idx_tb1234567890123456789012345678_16944_990017 ON tb1_20191001_990017 USING btree (c1)
 public     | tb1_20191001_990017 | pk_idx_tb1_16944_990017                         |            | CREATE UNIQUE INDEX pk_idx_tb1_16944_990017 ON tb1_20191001_990017 USING btree (c1)
 public     | tb1_20191101_990019 | idx_tb1234567890123456789012345678_16948_990019 |            | CREATE INDEX idx_tb1234567890123456789012345678_16948_990019 ON tb1_20191101_990019 USING btree (c1)
 public     | tb1_20191101_990019 | pk_idx_tb1_16948_990019                         |            | CREATE UNIQUE INDEX pk_idx_tb1_16948_990019 ON tb1_20191101_990019 USING btree (c1)
 public     | tb1_20191201_990021 | idx_tb1234567890123456789012345678_16952_990021 |            | CREATE INDEX idx_tb1234567890123456789012345678_16952_990021 ON tb1_20191201_990021 USING btree (c1)
 public     | tb1_20191201_990021 | pk_idx_tb1_16952_990021                         |            | CREATE UNIQUE INDEX pk_idx_tb1_16952_990021 ON tb1_20191201_990021 USING btree (c1)
(20 rows)


\c - - - :master_port

-- 批量truncate分区
select rds.truncate_range_partitions('public.tb1', '20190301', '20190603');
 truncate_range_partitions 
---------------------------
 
(1 row)


-- 验证数据
select * from public.tb1 order by c1;
 c1 |     c2     | c3 
----+------------+----
  4 | 06-04-2019 |  4
  5 | 07-05-2019 |  5
  6 | 08-06-2019 |  6
  7 | 09-07-2019 |  7
  8 | 10-08-2019 |  8
  9 | 11-09-2019 |  9
 10 | 12-10-2019 | 10
(7 rows)


-- ddl下推到分区（前）
select relname, reloptions from pg_class where relname like 'tb1%' order by relname;
   relname    | reloptions 
--------------+------------
 tb1          | 
 tb1_20190301 | 
 tb1_20190401 | 
 tb1_20190501 | 
 tb1_20190601 | 
 tb1_20190701 | 
 tb1_20190801 | 
 tb1_20190901 | 
 tb1_20191001 | 
 tb1_20191101 | 
 tb1_20191201 | 
(11 rows)


\c - - - :worker_1_port
select relname, reloptions from pg_class where relname like 'tb1%' order by relname;
       relname       | reloptions 
---------------------+------------
 tb1_20190301_990002 | 
 tb1_20190401_990004 | 
 tb1_20190501_990006 | 
 tb1_20190601_990008 | 
 tb1_20190701_990010 | 
 tb1_20190801_990012 | 
 tb1_20190901_990014 | 
 tb1_20191001_990016 | 
 tb1_20191101_990018 | 
 tb1_20191201_990020 | 
 tb1_990000          | 
(11 rows)


\c - - - :worker_2_port
select relname, reloptions from pg_class where relname like 'tb1%' order by relname;
       relname       | reloptions 
---------------------+------------
 tb1_20190301_990003 | 
 tb1_20190401_990005 | 
 tb1_20190501_990007 | 
 tb1_20190601_990009 | 
 tb1_20190701_990011 | 
 tb1_20190801_990013 | 
 tb1_20190901_990015 | 
 tb1_20191001_990017 | 
 tb1_20191101_990019 | 
 tb1_20191201_990021 | 
 tb1_990001          | 
(11 rows)


-- ddl下推到分区（后）
\c - - - :master_port
select rds.run_command_on_parted_table('public.tb1', 'alter table %t set(fillfactor = 90)');
                 run_command_on_parted_table                  
--------------------------------------------------------------
 ("alter table tb1_20190301 set(fillfactor = 90)",success,"")
 ("alter table tb1_20190401 set(fillfactor = 90)",success,"")
 ("alter table tb1_20190501 set(fillfactor = 90)",success,"")
 ("alter table tb1_20190601 set(fillfactor = 90)",success,"")
 ("alter table tb1_20190701 set(fillfactor = 90)",success,"")
 ("alter table tb1_20190801 set(fillfactor = 90)",success,"")
 ("alter table tb1_20190901 set(fillfactor = 90)",success,"")
 ("alter table tb1_20191001 set(fillfactor = 90)",success,"")
 ("alter table tb1_20191101 set(fillfactor = 90)",success,"")
 ("alter table tb1_20191201 set(fillfactor = 90)",success,"")
(10 rows)

select relname, reloptions from pg_class where relname like 'tb1%' order by relname;
   relname    |   reloptions    
--------------+-----------------
 tb1          | 
 tb1_20190301 | {fillfactor=90}
 tb1_20190401 | {fillfactor=90}
 tb1_20190501 | {fillfactor=90}
 tb1_20190601 | {fillfactor=90}
 tb1_20190701 | {fillfactor=90}
 tb1_20190801 | {fillfactor=90}
 tb1_20190901 | {fillfactor=90}
 tb1_20191001 | {fillfactor=90}
 tb1_20191101 | {fillfactor=90}
 tb1_20191201 | {fillfactor=90}
(11 rows)


\c - - - :worker_1_port
select relname, reloptions from pg_class where relname like 'tb1%' order by relname;
       relname       |   reloptions    
---------------------+-----------------
 tb1_20190301_990002 | {fillfactor=90}
 tb1_20190401_990004 | {fillfactor=90}
 tb1_20190501_990006 | {fillfactor=90}
 tb1_20190601_990008 | {fillfactor=90}
 tb1_20190701_990010 | {fillfactor=90}
 tb1_20190801_990012 | {fillfactor=90}
 tb1_20190901_990014 | {fillfactor=90}
 tb1_20191001_990016 | {fillfactor=90}
 tb1_20191101_990018 | {fillfactor=90}
 tb1_20191201_990020 | {fillfactor=90}
 tb1_990000          | 
(11 rows)


\c - - - :worker_2_port
select relname, reloptions from pg_class where relname like 'tb1%' order by relname;
       relname       |   reloptions    
---------------------+-----------------
 tb1_20190301_990003 | {fillfactor=90}
 tb1_20190401_990005 | {fillfactor=90}
 tb1_20190501_990007 | {fillfactor=90}
 tb1_20190601_990009 | {fillfactor=90}
 tb1_20190701_990011 | {fillfactor=90}
 tb1_20190801_990013 | {fillfactor=90}
 tb1_20190901_990015 | {fillfactor=90}
 tb1_20191001_990017 | {fillfactor=90}
 tb1_20191101_990019 | {fillfactor=90}
 tb1_20191201_990021 | {fillfactor=90}
 tb1_990001          | 
(11 rows)


\c - - - :master_port

-- 批量删除分区
select rds.drop_range_partitions('public.tb1', '20190301', '20190603');
 drop_range_partitions 
-----------------------
 
(1 row)


-- 验证分区
select relname, relnamespace::regnamespace::text, pg_get_expr(relpartbound, oid, true) vals
  from pg_class
 where relnamespace::regnamespace::text='public' and relname like 'tb1%' and relispartition=true
 order by relname;
   relname    | relnamespace |                       vals                       
--------------+--------------+--------------------------------------------------
 tb1_20190601 | public       | FOR VALUES FROM ('06-01-2019') TO ('07-01-2019')
 tb1_20190701 | public       | FOR VALUES FROM ('07-01-2019') TO ('08-01-2019')
 tb1_20190801 | public       | FOR VALUES FROM ('08-01-2019') TO ('09-01-2019')
 tb1_20190901 | public       | FOR VALUES FROM ('09-01-2019') TO ('10-01-2019')
 tb1_20191001 | public       | FOR VALUES FROM ('10-01-2019') TO ('11-01-2019')
 tb1_20191101 | public       | FOR VALUES FROM ('11-01-2019') TO ('12-01-2019')
 tb1_20191201 | public       | FOR VALUES FROM ('12-01-2019') TO ('01-01-2020')
(7 rows)


\c - - - :worker_1_port
select relname, relnamespace::regnamespace::text, pg_get_expr(relpartbound, oid, true) vals
  from pg_class
 where relnamespace::regnamespace::text='public' and relname like 'tb1%' and relispartition=true
 order by relname;
       relname       | relnamespace |                       vals                       
---------------------+--------------+--------------------------------------------------
 tb1_20190601_990008 | public       | FOR VALUES FROM ('06-01-2019') TO ('07-01-2019')
 tb1_20190701_990010 | public       | FOR VALUES FROM ('07-01-2019') TO ('08-01-2019')
 tb1_20190801_990012 | public       | FOR VALUES FROM ('08-01-2019') TO ('09-01-2019')
 tb1_20190901_990014 | public       | FOR VALUES FROM ('09-01-2019') TO ('10-01-2019')
 tb1_20191001_990016 | public       | FOR VALUES FROM ('10-01-2019') TO ('11-01-2019')
 tb1_20191101_990018 | public       | FOR VALUES FROM ('11-01-2019') TO ('12-01-2019')
 tb1_20191201_990020 | public       | FOR VALUES FROM ('12-01-2019') TO ('01-01-2020')
(7 rows)


\c - - - :worker_2_port
select relname, relnamespace::regnamespace::text, pg_get_expr(relpartbound, oid, true) vals
  from pg_class
 where relnamespace::regnamespace::text='public' and relname like 'tb1%' and relispartition=true
 order by relname;
       relname       | relnamespace |                       vals                       
---------------------+--------------+--------------------------------------------------
 tb1_20190601_990009 | public       | FOR VALUES FROM ('06-01-2019') TO ('07-01-2019')
 tb1_20190701_990011 | public       | FOR VALUES FROM ('07-01-2019') TO ('08-01-2019')
 tb1_20190801_990013 | public       | FOR VALUES FROM ('08-01-2019') TO ('09-01-2019')
 tb1_20190901_990015 | public       | FOR VALUES FROM ('09-01-2019') TO ('10-01-2019')
 tb1_20191001_990017 | public       | FOR VALUES FROM ('10-01-2019') TO ('11-01-2019')
 tb1_20191101_990019 | public       | FOR VALUES FROM ('11-01-2019') TO ('12-01-2019')
 tb1_20191201_990021 | public       | FOR VALUES FROM ('12-01-2019') TO ('01-01-2020')
(7 rows)


\c - - - :master_port

-- ddl带双引号
create table "tb2"(c1 int, c2 date, c3 int) partition by range (c2);
ERROR:  DDL statement can not contain double quotes.
CONTEXT:  PL/pgSQL function rds.func_ddl_command_start() line 45 at RAISE

-- 删除分区表
drop table if exists tb1 cascade;
